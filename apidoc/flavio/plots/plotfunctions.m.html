<!doctype html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />

    <title>flavio.plots.plotfunctions API documentation</title>
    <meta name="description" content="" />

  <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Noto+Sans:400' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/public/plugins/katex/katex.min.css">
  
  <style type="text/css">
  
* {
  box-sizing: border-box;
}
/*! normalize.css v1.1.1 | MIT License | git.io/normalize */

/* ==========================================================================
   HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block;
}

/**
 * Correct `inline-block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

audio,
canvas,
video {
    display: inline-block;
    *display: inline;
    *zoom: 1;
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
    display: none;
    height: 0;
}

/**
 * Address styling not present in IE 7/8/9, Firefox 3, and Safari 4.
 * Known issue: no IE 6 support.
 */

[hidden] {
    display: none;
}

/* ==========================================================================
   Base
   ========================================================================== */

/**
 * 1. Prevent system color scheme's background color being used in Firefox, IE,
 *    and Opera.
 * 2. Prevent system color scheme's text color being used in Firefox, IE, and
 *    Opera.
 * 3. Correct text resizing oddly in IE 6/7 when body `font-size` is set using
 *    `em` units.
 * 4. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
    background: #fff; /* 1 */
    color: #000; /* 2 */
    font-size: 100%; /* 3 */
    -webkit-text-size-adjust: 100%; /* 4 */
    -ms-text-size-adjust: 100%; /* 4 */
}

/**
 * Address `font-family` inconsistency between `textarea` and other form
 * elements.
 */

html,
button,
input,
select,
textarea {
    font-family: sans-serif;
}

/**
 * Address margins handled incorrectly in IE 6/7.
 */

body {
    margin: 0;
}

/* ==========================================================================
   Links
   ========================================================================== */

/**
 * Address `outline` inconsistency between Chrome and other browsers.
 */

a:focus {
    outline: thin dotted;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
    outline: 0;
}

/* ==========================================================================
   Typography
   ========================================================================== */

/**
 * Address font sizes and margins set differently in IE 6/7.
 * Address font sizes within `section` and `article` in Firefox 4+, Safari 5,
 * and Chrome.
 */

h1 {
    font-size: 2em;
    margin: 0.67em 0;
}

h2 {
    font-size: 1.5em;
    margin: 0.83em 0;
}

h3 {
    font-size: 1.17em;
    margin: 1em 0;
}

h4 {
    font-size: 1em;
    margin: 1.33em 0;
}

h5 {
    font-size: 0.83em;
    margin: 1.67em 0;
}

h6 {
    font-size: 0.67em;
    margin: 2.33em 0;
}

/**
 * Address styling not present in IE 7/8/9, Safari 5, and Chrome.
 */

abbr[title] {
    border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 3+, Safari 4/5, and Chrome.
 */

b,
strong {
    font-weight: bold;
}

blockquote {
    margin: 1em 40px;
}

/**
 * Address styling not present in Safari 5 and Chrome.
 */

dfn {
    font-style: italic;
}

/**
 * Address differences between Firefox and other browsers.
 * Known issue: no IE 6/7 normalization.
 */

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/**
 * Address styling not present in IE 6/7/8/9.
 */

mark {
    background: #ff0;
    color: #000;
}

/**
 * Address margins set differently in IE 6/7.
 */

p,
pre {
    margin: 1em 0;
}

/**
 * Correct font family set oddly in IE 6, Safari 4/5, and Chrome.
 */

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    _font-family: 'courier new', monospace;
    font-size: 1em;
}

/**
 * Improve readability of pre-formatted text in all browsers.
 */

pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/**
 * Address CSS quotes not supported in IE 6/7.
 */

q {
    quotes: none;
}

/**
 * Address `quotes` property not supported in Safari 4.
 */

q:before,
q:after {
    content: '';
    content: none;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
    font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ==========================================================================
   Lists
   ========================================================================== */

/**
 * Address margins set differently in IE 6/7.
 */

dl,
menu,
ol,
ul {
    margin: 1em 0;
}

dd {
    margin: 0 0 0 40px;
}

/**
 * Address paddings set differently in IE 6/7.
 */

menu,
ol,
ul {
    padding: 0 0 0 40px;
}

/**
 * Correct list images handled incorrectly in IE 7.
 */

nav ul,
nav ol {
    list-style: none;
    list-style-image: none;
}

/* ==========================================================================
   Embedded content
   ========================================================================== */

/**
 * 1. Remove border when inside `a` element in IE 6/7/8/9 and Firefox 3.
 * 2. Improve image quality when scaled in IE 7.
 */

img {
    border: 0; /* 1 */
    -ms-interpolation-mode: bicubic; /* 2 */
}

/**
 * Correct overflow displayed oddly in IE 9.
 */

svg:not(:root) {
    overflow: hidden;
}

/* ==========================================================================
   Figures
   ========================================================================== */

/**
 * Address margin not present in IE 6/7/8/9, Safari 5, and Opera 11.
 */

figure {
    margin: 0;
}

/* ==========================================================================
   Forms
   ========================================================================== */

/**
 * Correct margin displayed oddly in IE 6/7.
 */

form {
    margin: 0;
}

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct color not being inherited in IE 6/7/8/9.
 * 2. Correct text not wrapping in Firefox 3.
 * 3. Correct alignment displayed oddly in IE 6/7.
 */

legend {
    border: 0; /* 1 */
    padding: 0;
    white-space: normal; /* 2 */
    *margin-left: -7px; /* 3 */
}

/**
 * 1. Correct font size not being inherited in all browsers.
 * 2. Address margins set differently in IE 6/7, Firefox 3+, Safari 5,
 *    and Chrome.
 * 3. Improve appearance and consistency in all browsers.
 */

button,
input,
select,
textarea {
    font-size: 100%; /* 1 */
    margin: 0; /* 2 */
    vertical-align: baseline; /* 3 */
    *vertical-align: middle; /* 3 */
}

/**
 * Address Firefox 3+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

button,
input {
    line-height: normal;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Chrome, Safari 5+, and IE 6+.
 * Correct `select` style inheritance in Firefox 4+ and Opera.
 */

button,
select {
    text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 * 4. Remove inner spacing in IE 7 without affecting normal text inputs.
 *    Known issue: inner spacing remains in IE 6.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
    *overflow: visible;  /* 4 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
    cursor: default;
}

/**
 * 1. Address box sizing set to content-box in IE 8/9.
 * 2. Remove excess padding in IE 8/9.
 * 3. Remove excess padding in IE 7.
 *    Known issue: excess padding remains in IE 6.
 */

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
    *height: 13px; /* 3 */
    *width: 13px; /* 3 */
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari 5 and Chrome
 * on OS X.
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/**
 * Remove inner padding and border in Firefox 3+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/**
 * 1. Remove default vertical scrollbar in IE 6/7/8/9.
 * 2. Improve readability and alignment in all browsers.
 */

textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ==========================================================================
   Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
    border-collapse: collapse;
    border-spacing: 0;
}

    .katex {
      font-size:1em;
    }
    .katex .mathit, .katex .mathrm {
      font-family: 'Noto Sans';
    }
  </style>

  <style type="text/css">
  
  html, body {
    margin: 0;
    padding: 0;
    min-height: 100%;
  }
  body {
    background: #fff;
    font-family: "Noto Sans", "Helvetica Neue", Helvetica, sans;
    font-weight: 400;
    font-size: 16px;
    line-height: 1.6em;
  }
  #content {
    width: 70%;
    max-width: 850px;
    float: left;
    padding: 30px 60px;
    border-left: 1px solid #ddd;
  }
  #sidebar {
    width: 25%;
    float: left;
    padding: 30px;
    overflow: hidden;
  }
  #nav {
    font-size: 130%;
    margin: 0 0 15px 0;
  }

  #top {
    display: block;
    position: fixed;
    bottom: 5px;
    left: 5px;
    font-size: .85em;
    text-transform: uppercase;
  }

  #footer {
    font-size: .75em;
    padding: 5px 30px;
    border-top: 1px solid #ddd;
    text-align: right;
  }
    #footer p {
      margin: 0 0 0 30px;
      display: inline-block;
    }

  h1, h2, h3, h4, h5 {
    font-weight: 300;
  }
  h1 {
    font-size: 2.5em;
    line-height: 1.1em;
    margin: 0 0 .50em 0;
  }

  h2 {
    font-size: 1.75em;
    margin: 1em 0 .50em 0;
  }

  h3 {
    margin: 25px 0 10px 0;
  }

  h4 {
    margin: 0;
    font-size: 105%;
  }

  a {
    color: #058;
    text-decoration: none;
    transition: color .3s ease-in-out;
  }

  a:hover {
    color: #e08524;
    transition: color .3s ease-in-out;
  }

  pre, code, .mono, .name {
    font-family: "Ubuntu Mono", "Cousine", "DejaVu Sans Mono", monospace;
  }

  .title .name {
    font-weight: bold;
  }
  .section-title {
    margin-top: 2em;
  }
  .ident {
    color: #900;
  }

  code {
    background: #f9f9f9;
  }

  pre {
    background: #fefefe;
    border: 1px solid #ddd;
    box-shadow: 2px 2px 0 #f3f3f3;
    margin: 0 30px;
    padding: 15px 30px;
  }

  .codehilite {
    margin: 0 30px 10px 30px;
  }

    .codehilite pre {
      margin: 0;
    }
    .codehilite .err { background: #ff3300; color: #fff !important; }

  table#module-list {
    font-size: 110%;
  }

    table#module-list tr td:first-child {
      padding-right: 10px;
      white-space: nowrap;
    }

    table#module-list td {
      vertical-align: top;
      padding-bottom: 8px;
    }

      table#module-list td p {
        margin: 0 0 7px 0;
      }

  .def {
    display: table;
  }

    .def p {
      display: table-cell;
      vertical-align: top;
      text-align: left;
    }

    .def p:first-child {
      white-space: nowrap;
    }

    .def p:last-child {
      width: 100%;
    }


  #index {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
    ul#index .class_name {
      /* font-size: 110%; */
      font-weight: bold;
    }
    #index ul {
      margin: 0;
    }

  .item {
    margin: 0 0 15px 0;
  }

    .item .class {
      margin: 0 0 25px 30px;
    }

      .item .class ul.class_list {
        margin: 0 0 20px 0;
      }

    .item .name {
      background: #fafafa;
      margin: 0;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 3px;
      display: inline-block;
      min-width: 40%;
    }
      .item .name:hover {
        background: #f6f6f6;
      }

    .item .empty_desc {
      margin: 0 0 5px 0;
      padding: 0;
    }

    .item .inheritance {
      margin: 3px 0 0 30px;
    }

    .item .inherited {
      color: #666;
    }

    .item .desc {
      padding: 0 8px;
      margin: 0;
    }

      .item .desc p {
        margin: 0 0 10px 0;
      }

    .source_cont {
      margin: 0;
      padding: 0;
    }

    .source_link a {
      background: #ffc300;
      font-weight: 400;
      font-size: .75em;
      text-transform: uppercase;
      color: #fff;
      text-shadow: 1px 1px 0 #f4b700;

      padding: 3px 8px;
      border-radius: 2px;
      transition: background .3s ease-in-out;
    }
      .source_link a:hover {
        background: #FF7200;
        text-shadow: none;
        transition: background .3s ease-in-out;
      }

    .source {
      display: none;
      max-height: 600px;
      overflow-y: scroll;
      margin-bottom: 15px;
    }

      .source .codehilite {
        margin: 0;
      }

  .desc h1, .desc h2, .desc h3 {
    font-size: 100% !important;
  }
  .clear {
    clear: both;
  }

  @media all and (max-width: 950px) {
    #sidebar {
      width: 35%;
    }
    #content {
      width: 65%;
    }
  }
  @media all and (max-width: 650px) {
    #top {
      display: none;
    }
    #sidebar {
      float: none;
      width: auto;
    }
    #content {
      float: none;
      width: auto;
      padding: 30px;
    }

    #index ul {
      padding: 0;
      margin-bottom: 15px;
    }
    #index ul li {
      display: inline-block;
      margin-right: 30px;
    }
    #footer {
      text-align: left;
    }
    #footer p {
      display: block;
      margin: inherit;
    }
  }

  /*****************************/

  </style>

  <style type="text/css">
  .codehilite .hll { background-color: #ffffcc }
.codehilite  { background: #f8f8f8; }
.codehilite .c { color: #408080; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #FF0000 } /* Error */
.codehilite .k { color: #008000; font-weight: bold } /* Keyword */
.codehilite .o { color: #666666 } /* Operator */
.codehilite .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.codehilite .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #BC7A00 } /* Comment.Preproc */
.codehilite .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.codehilite .c1 { color: #408080; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #408080; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #FF0000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #00A000 } /* Generic.Inserted */
.codehilite .go { color: #888888 } /* Generic.Output */
.codehilite .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #0044DD } /* Generic.Traceback */
.codehilite .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #008000 } /* Keyword.Pseudo */
.codehilite .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #B00040 } /* Keyword.Type */
.codehilite .m { color: #666666 } /* Literal.Number */
.codehilite .s { color: #BA2121 } /* Literal.String */
.codehilite .na { color: #7D9029 } /* Name.Attribute */
.codehilite .nb { color: #008000 } /* Name.Builtin */
.codehilite .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.codehilite .no { color: #880000 } /* Name.Constant */
.codehilite .nd { color: #AA22FF } /* Name.Decorator */
.codehilite .ni { color: #999999; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #0000FF } /* Name.Function */
.codehilite .nl { color: #A0A000 } /* Name.Label */
.codehilite .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #008000; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #19177C } /* Name.Variable */
.codehilite .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #bbbbbb } /* Text.Whitespace */
.codehilite .mb { color: #666666 } /* Literal.Number.Bin */
.codehilite .mf { color: #666666 } /* Literal.Number.Float */
.codehilite .mh { color: #666666 } /* Literal.Number.Hex */
.codehilite .mi { color: #666666 } /* Literal.Number.Integer */
.codehilite .mo { color: #666666 } /* Literal.Number.Oct */
.codehilite .sa { color: #BA2121 } /* Literal.String.Affix */
.codehilite .sb { color: #BA2121 } /* Literal.String.Backtick */
.codehilite .sc { color: #BA2121 } /* Literal.String.Char */
.codehilite .dl { color: #BA2121 } /* Literal.String.Delimiter */
.codehilite .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #BA2121 } /* Literal.String.Double */
.codehilite .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #BA2121 } /* Literal.String.Heredoc */
.codehilite .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.codehilite .sx { color: #008000 } /* Literal.String.Other */
.codehilite .sr { color: #BB6688 } /* Literal.String.Regex */
.codehilite .s1 { color: #BA2121 } /* Literal.String.Single */
.codehilite .ss { color: #19177C } /* Literal.String.Symbol */
.codehilite .bp { color: #008000 } /* Name.Builtin.Pseudo */
.codehilite .fm { color: #0000FF } /* Name.Function.Magic */
.codehilite .vc { color: #19177C } /* Name.Variable.Class */
.codehilite .vg { color: #19177C } /* Name.Variable.Global */
.codehilite .vi { color: #19177C } /* Name.Variable.Instance */
.codehilite .vm { color: #19177C } /* Name.Variable.Magic */
.codehilite .il { color: #666666 } /* Literal.Number.Integer.Long */
  </style>

  <style type="text/css">
  
/* ==========================================================================
   EXAMPLE Media Queries for Responsive Design.
   These examples override the primary ('mobile first') styles.
   Modify as content requires.
   ========================================================================== */

@media only screen and (min-width: 35em) {
    /* Style adjustments for viewports that meet the condition */
}

@media print,
       (-o-min-device-pixel-ratio: 5/4),
       (-webkit-min-device-pixel-ratio: 1.25),
       (min-resolution: 120dpi) {
    /* Style adjustments for high resolution devices */
}

/* ==========================================================================
   Print styles.
   Inlined to avoid required HTTP connection: h5bp.com/r
   ========================================================================== */

@media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a,
    a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    /*
     * Don't show links for images, or javascript/internal links
     */

    .ir a:after,
    a[href^="javascript:"]:after,
    a[href^="#"]:after {
        content: "";
    }

    pre,
    blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr,
    img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p,
    h2,
    h3 {
        orphans: 3;
        widows: 3;
    }

    h2,
    h3 {
        page-break-after: avoid;
    }
}

  </style>

  <script type="text/javascript">
  function toggle(id, $link) {
    $node = document.getElementById(id);
    if (!$node)
    return;
    if (!$node.style.display || $node.style.display == 'none') {
    $node.style.display = 'block';
    $link.innerHTML = 'Hide source &nequiv;';
    } else {
    $node.style.display = 'none';
    $link.innerHTML = 'Show source &equiv;';
    }
  }
  </script>
    <script src="/public/plugins/katex/katex.min.js"></script>
    <script src="/public/plugins/katex/auto-render.min.js"></script>
</head>
<body>
<a href="#" id="top">Top</a>

<div id="container">
    
  
  <div id="sidebar">
    <h1>Index</h1>
    <ul id="index">

    <li class="set"><h3><a href="#header-functions">Functions</a></h3>
      
  <ul>
    <li class="mono"><a href="#flavio.plots.plotfunctions.band_plot">band_plot</a></li>
    <li class="mono"><a href="#flavio.plots.plotfunctions.contour">contour</a></li>
    <li class="mono"><a href="#flavio.plots.plotfunctions.density_contour">density_contour</a></li>
    <li class="mono"><a href="#flavio.plots.plotfunctions.density_contour_data">density_contour_data</a></li>
    <li class="mono"><a href="#flavio.plots.plotfunctions.error_budget_pie">error_budget_pie</a></li>
    <li class="mono"><a href="#flavio.plots.plotfunctions.flavio_box">flavio_box</a></li>
    <li class="mono"><a href="#flavio.plots.plotfunctions.flavio_branding">flavio_branding</a></li>
    <li class="mono"><a href="#flavio.plots.plotfunctions.likelihood_contour">likelihood_contour</a></li>
    <li class="mono"><a href="#flavio.plots.plotfunctions.likelihood_contour_data">likelihood_contour_data</a></li>
    <li class="mono"><a href="#flavio.plots.plotfunctions.likelihood_plot">likelihood_plot</a></li>
    <li class="mono"><a href="#flavio.plots.plotfunctions.pdf_plot">pdf_plot</a></li>
    <li class="mono"><a href="#flavio.plots.plotfunctions.q2_plot_exp">q2_plot_exp</a></li>
    <li class="mono"><a href="#flavio.plots.plotfunctions.q2_plot_th_bin">q2_plot_th_bin</a></li>
    <li class="mono"><a href="#flavio.plots.plotfunctions.q2_plot_th_diff">q2_plot_th_diff</a></li>
    <li class="mono"><a href="#flavio.plots.plotfunctions.smooth_histogram">smooth_histogram</a></li>
  </ul>

    </li>


    </ul>
  </div>

    <article id="content">
      
  

  


  <header id="section-intro">
  <h1 class="title"><span class="name">flavio.plots.plotfunctions</span> module</h1>
  
  
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.plots.plotfunctions', this);">Show source &equiv;</a></p>
  <div id="source-flavio.plots.plotfunctions" class="source">
    <div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="kn">as</span> <span class="nn">patches</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">flavio</span>
<span class="kn">from</span> <span class="nn">flavio.statistics.functions</span> <span class="kn">import</span> <span class="n">delta_chi2</span><span class="p">,</span> <span class="n">confidence_level</span>
<span class="kn">import</span> <span class="nn">scipy.optimize</span>
<span class="kn">import</span> <span class="nn">scipy.interpolate</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span>
<span class="kn">from</span> <span class="nn">numbers</span> <span class="kn">import</span> <span class="n">Number</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sqrt</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="k">def</span> <span class="nf">error_budget_pie</span><span class="p">(</span><span class="n">err_dict</span><span class="p">,</span> <span class="n">other_cutoff</span><span class="o">=</span><span class="mf">0.03</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Pie chart of an observable&#39;s error budget.</span>

<span class="sd">    Parameters:</span>

<span class="sd">    - `err_dict`: Dictionary as return from `flavio.sm_error_budget`</span>
<span class="sd">    - `other_cutoff`: If an individual error contribution divided by the total</span>
<span class="sd">      error is smaller than this number, it is lumped under &quot;other&quot;. Defaults</span>
<span class="sd">      to 0.03.</span>

<span class="sd">    Note that for uncorrelated parameters, the total uncertainty is the squared</span>
<span class="sd">    sum of the individual uncertainties, so the relative size of the wedges does</span>
<span class="sd">    not correspond to the relative contribution to the total uncertainty.</span>

<span class="sd">    If the uncertainties of individual parameters are correlated, the total</span>
<span class="sd">    uncertainty can be larger or smaller than the squared sum of the individual</span>
<span class="sd">    uncertainties, so the representation can be misleading.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">err_tot</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">err_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="n">err_dict_sorted</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">err_dict</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="o">-</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">fracs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">small_frac</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">err_dict_sorted</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">frac</span> <span class="o">=</span> <span class="n">value</span><span class="o">/</span><span class="n">err_tot</span>
        <span class="k">if</span> <span class="n">frac</span> <span class="o">&gt;</span> <span class="n">other_cutoff</span><span class="p">:</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flavio</span><span class="o">.</span><span class="n">Parameter</span><span class="o">.</span><span class="n">get_instance</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">tex</span><span class="p">)</span>
            <span class="n">fracs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frac</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">small_frac</span> <span class="o">+=</span> <span class="n">frac</span>
    <span class="k">if</span> <span class="n">small_frac</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;other&#39;</span><span class="p">)</span>
        <span class="n">fracs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">small_frac</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">my_autopct</span><span class="p">(</span><span class="n">pct</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;{p:.1f}\%&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">pct</span><span class="o">*</span><span class="n">err_tot</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">fracs</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">autopct</span><span class="o">=</span><span class="n">my_autopct</span><span class="p">,</span> <span class="n">wedgeprops</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;linewidth&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">},</span> <span class="n">colors</span><span class="o">=</span><span class="n">flavio</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">pastel</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">q2_plot_th_diff</span><span class="p">(</span><span class="n">obs_name</span><span class="p">,</span> <span class="n">q2min</span><span class="p">,</span> <span class="n">q2max</span><span class="p">,</span> <span class="n">wc</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">q2steps</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Plot the central theory prediction of a $q^2$-dependent observable</span>
<span class="sd">    as a function of $q^2$.</span>

<span class="sd">    Parameters:</span>

<span class="sd">    - `q2min`, `q2max`: minimum and maximum $q^2$ values in GeV^2</span>
<span class="sd">    - `wc` (optional): `WilsonCoefficient` instance to define beyond-the-SM</span>
<span class="sd">      Wilson coefficients</span>
<span class="sd">    - `q2steps` (optional): number of $q^2$ steps. Defaults to 100. Less is</span>
<span class="sd">      faster but less precise.</span>

<span class="sd">    Additional keyword arguments are passed to the matplotlib plot function,</span>
<span class="sd">    e.g. &#39;c&#39; for colour.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">obs</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Observable</span><span class="o">.</span><span class="n">get_instance</span><span class="p">(</span><span class="n">obs_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">obs</span><span class="o">.</span><span class="n">arguments</span> <span class="o">!=</span> <span class="p">[</span><span class="s1">&#39;q2&#39;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Only observables that depend on $q^2$ (and nothing else) are allowed&quot;</span><span class="p">)</span>
    <span class="n">q2_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">q2min</span><span class="p">,</span> <span class="n">q2max</span><span class="p">,</span> <span class="p">(</span><span class="n">q2max</span><span class="o">-</span><span class="n">q2min</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">q2steps</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">wc</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">wc</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">WilsonCoefficients</span><span class="p">()</span> <span class="c1"># SM Wilson coefficients</span>
        <span class="n">obs_arr</span> <span class="o">=</span> <span class="p">[</span><span class="n">flavio</span><span class="o">.</span><span class="n">sm_prediction</span><span class="p">(</span><span class="n">obs_name</span><span class="p">,</span> <span class="n">q2</span><span class="p">)</span> <span class="k">for</span> <span class="n">q2</span> <span class="ow">in</span> <span class="n">q2_arr</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">obs_arr</span> <span class="o">=</span> <span class="p">[</span><span class="n">flavio</span><span class="o">.</span><span class="n">np_prediction</span><span class="p">(</span><span class="n">obs_name</span><span class="p">,</span> <span class="n">wc</span><span class="p">,</span> <span class="n">q2</span><span class="p">)</span> <span class="k">for</span> <span class="n">q2</span> <span class="ow">in</span> <span class="n">q2_arr</span><span class="p">]</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="k">if</span> <span class="s1">&#39;c&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="s1">&#39;color&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">q2_arr</span><span class="p">,</span> <span class="n">obs_arr</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">q2_plot_th_bin</span><span class="p">(</span><span class="n">obs_name</span><span class="p">,</span> <span class="n">bin_list</span><span class="p">,</span> <span class="n">wc</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">divide_binwidth</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Plot the binned theory prediction with uncertainties of a</span>
<span class="sd">    $q^2$-dependent observable as a function of $q^2$  (in the form of coloured</span>
<span class="sd">    boxes).</span>

<span class="sd">    Parameters:</span>

<span class="sd">    - `bin_list`: a list of tuples containing bin boundaries</span>
<span class="sd">    - `wc` (optional): `WilsonCoefficient` instance to define beyond-the-SM</span>
<span class="sd">      Wilson coefficients</span>
<span class="sd">    - `divide_binwidth` (optional): this should be set to True when comparing</span>
<span class="sd">      integrated branching ratios from experiments with different bin widths</span>
<span class="sd">      or to theory predictions for a differential branching ratio. It will</span>
<span class="sd">      divide all values and uncertainties by the bin width (i.e. dimensionless</span>
<span class="sd">      integrated BRs will be converted to integrated differential BRs with</span>
<span class="sd">      dimensions of GeV$^{-2}$). Defaults to False.</span>
<span class="sd">    - `N` (optional): number of random draws to determine the uncertainty.</span>
<span class="sd">      Defaults to 50. Larger is slower but more precise. The relative</span>
<span class="sd">      error of the theory uncertainty scales as $1/\sqrt{2N}$.</span>

<span class="sd">    Additional keyword arguments are passed to the matplotlib add_patch function,</span>
<span class="sd">    e.g. &#39;fc&#39; for face colour.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">obs</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Observable</span><span class="o">.</span><span class="n">get_instance</span><span class="p">(</span><span class="n">obs_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">obs</span><span class="o">.</span><span class="n">arguments</span> <span class="o">!=</span> <span class="p">[</span><span class="s1">&#39;q2min&#39;</span><span class="p">,</span> <span class="s1">&#39;q2max&#39;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Only observables that depend on q2min and q2max (and nothing else) are allowed&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">wc</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">wc</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">WilsonCoefficients</span><span class="p">()</span> <span class="c1"># SM Wilson coefficients</span>
        <span class="n">obs_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">bin_</span><span class="p">:</span> <span class="n">flavio</span><span class="o">.</span><span class="n">sm_prediction</span><span class="p">(</span><span class="n">obs_name</span><span class="p">,</span> <span class="o">*</span><span class="n">bin_</span><span class="p">)</span> <span class="k">for</span> <span class="n">bin_</span> <span class="ow">in</span> <span class="n">bin_list</span><span class="p">}</span>
        <span class="n">obs_err_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">bin_</span><span class="p">:</span> <span class="n">flavio</span><span class="o">.</span><span class="n">sm_uncertainty</span><span class="p">(</span><span class="n">obs_name</span><span class="p">,</span> <span class="o">*</span><span class="n">bin_</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="n">N</span><span class="p">)</span> <span class="k">for</span> <span class="n">bin_</span> <span class="ow">in</span> <span class="n">bin_list</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">obs_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">bin_</span><span class="p">:</span><span class="n">flavio</span><span class="o">.</span><span class="n">np_prediction</span><span class="p">(</span><span class="n">obs_name</span><span class="p">,</span> <span class="n">wc</span><span class="p">,</span> <span class="o">*</span><span class="n">bin_</span><span class="p">)</span> <span class="k">for</span> <span class="n">bin_</span> <span class="ow">in</span> <span class="n">bin_list</span><span class="p">}</span>
        <span class="n">obs_err_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">bin_</span><span class="p">:</span> <span class="n">flavio</span><span class="o">.</span><span class="n">np_uncertainty</span><span class="p">(</span><span class="n">obs_name</span><span class="p">,</span> <span class="n">wc</span><span class="p">,</span> <span class="o">*</span><span class="n">bin_</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="n">N</span><span class="p">)</span> <span class="k">for</span> <span class="n">bin_</span> <span class="ow">in</span> <span class="n">bin_list</span><span class="p">}</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">_i</span><span class="p">,</span> <span class="p">(</span><span class="n">bin_</span><span class="p">,</span> <span class="n">central_</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">obs_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="n">q2min</span><span class="p">,</span> <span class="n">q2max</span> <span class="o">=</span> <span class="n">bin_</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">obs_err_dict</span><span class="p">[</span><span class="n">bin_</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">divide_binwidth</span><span class="p">:</span>
            <span class="n">err</span> <span class="o">=</span> <span class="n">err</span><span class="o">/</span><span class="p">(</span><span class="n">q2max</span><span class="o">-</span><span class="n">q2min</span><span class="p">)</span>
            <span class="n">central</span> <span class="o">=</span> <span class="n">central_</span><span class="o">/</span><span class="p">(</span><span class="n">q2max</span><span class="o">-</span><span class="n">q2min</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">central</span> <span class="o">=</span> <span class="n">central_</span>
        <span class="k">if</span> <span class="s1">&#39;fc&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="s1">&#39;facecolor&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">pastel</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;linewidth&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="s1">&#39;lw&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;lw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">_i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># the label should only be set for one (i.e. the first)</span>
            <span class="c1"># of the boxes, otherwise it will appear multiply in the legend</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">q2min</span><span class="p">,</span> <span class="n">central</span><span class="o">-</span><span class="n">err</span><span class="p">),</span> <span class="n">q2max</span><span class="o">-</span><span class="n">q2min</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">err</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">q2_plot_exp</span><span class="p">(</span><span class="n">obs_name</span><span class="p">,</span> <span class="n">col_dict</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">divide_binwidth</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">include_measurements</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                <span class="n">include_bins</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">exclude_bins</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Plot all existing experimental measurements of a $q^2$-dependent</span>
<span class="sd">    observable as a function of $q^2$  (in the form of coloured crosses).</span>

<span class="sd">    Parameters:</span>

<span class="sd">    - `col_dict` (optional): a dictionary to assign colours to specific</span>
<span class="sd">      experiments, e.g. `{&#39;BaBar&#39;: &#39;b&#39;, &#39;Belle&#39;: &#39;r&#39;}`</span>
<span class="sd">    - `divide_binwidth` (optional): this should be set to True when comparing</span>
<span class="sd">      integrated branching ratios from experiments with different bin widths</span>
<span class="sd">      or to theory predictions for a differential branching ratio. It will</span>
<span class="sd">      divide all values and uncertainties by the bin width (i.e. dimensionless</span>
<span class="sd">      integrated BRs will be converted to integrated differential BRs with</span>
<span class="sd">      dimensions of GeV$^{-2}$). Defaults to False.</span>
<span class="sd">    - `include_measurements` (optional): a list of strings with measurement</span>
<span class="sd">      names (see measurements.yml) to include in the plot. By default, all</span>
<span class="sd">      existing measurements will be included.</span>
<span class="sd">    - `include_bins` (optional): a list of bins (as tuples of the bin</span>
<span class="sd">      boundaries) to include in the plot. By default, all measured bins</span>
<span class="sd">      will be included. Should not be specified simultaneously with</span>
<span class="sd">      `exclude_bins`.</span>
<span class="sd">    - `exclude_bins` (optional): a list of bins (as tuples of the bin</span>
<span class="sd">      boundaries) not to include in the plot. By default, all measured bins</span>
<span class="sd">      will be included. Should not be specified simultaneously with</span>
<span class="sd">      `include_bins`.</span>

<span class="sd">    Additional keyword arguments are passed to the matplotlib errorbar function,</span>
<span class="sd">    e.g. &#39;c&#39; for colour.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">obs</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Observable</span><span class="o">.</span><span class="n">get_instance</span><span class="p">(</span><span class="n">obs_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">obs</span><span class="o">.</span><span class="n">arguments</span> <span class="o">!=</span> <span class="p">[</span><span class="s1">&#39;q2min&#39;</span><span class="p">,</span> <span class="s1">&#39;q2max&#39;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Only observables that depend on q2min and q2max (and nothing else) are allowed&quot;</span><span class="p">)</span>
    <span class="n">_experiment_labels</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># list of experiments appearing in the plot legend</span>
    <span class="k">for</span> <span class="n">m_name</span><span class="p">,</span> <span class="n">m_obj</span> <span class="ow">in</span> <span class="n">flavio</span><span class="o">.</span><span class="n">Measurement</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">include_measurements</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">m_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">include_measurements</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">obs_name_list</span> <span class="o">=</span> <span class="n">m_obj</span><span class="o">.</span><span class="n">all_parameters</span>
        <span class="n">obs_name_list_binned</span> <span class="o">=</span> <span class="p">[</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obs_name_list</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="n">obs_name</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">obs_name_list_binned</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">central</span> <span class="o">=</span> <span class="n">m_obj</span><span class="o">.</span><span class="n">get_central_all</span><span class="p">()</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">m_obj</span><span class="o">.</span><span class="n">get_1d_errors_rightleft</span><span class="p">()</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dy_lower</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dy_upper</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">q2min</span><span class="p">,</span> <span class="n">q2max</span> <span class="ow">in</span> <span class="n">obs_name_list_binned</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">include_bins</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">exclude_bins</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please only specify include_bins or exclude_bins, not both&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">q2min</span><span class="p">,</span> <span class="n">q2max</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">include_bins</span><span class="p">:</span>
                    <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">exclude_bins</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">q2min</span><span class="p">,</span> <span class="n">q2max</span><span class="p">)</span> <span class="ow">in</span> <span class="n">exclude_bins</span><span class="p">:</span>
                    <span class="k">continue</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">central</span><span class="p">[(</span><span class="n">obs_name</span><span class="p">,</span> <span class="n">q2min</span><span class="p">,</span> <span class="n">q2max</span><span class="p">)]</span>
            <span class="n">e_right</span><span class="p">,</span> <span class="n">e_left</span> <span class="o">=</span> <span class="n">err</span><span class="p">[(</span><span class="n">obs_name</span><span class="p">,</span> <span class="n">q2min</span><span class="p">,</span> <span class="n">q2max</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">divide_binwidth</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="o">/</span><span class="p">(</span><span class="n">q2max</span><span class="o">-</span><span class="n">q2min</span><span class="p">)</span>
                <span class="n">e_left</span> <span class="o">=</span> <span class="n">e_left</span><span class="o">/</span><span class="p">(</span><span class="n">q2max</span><span class="o">-</span><span class="n">q2min</span><span class="p">)</span>
                <span class="n">e_right</span> <span class="o">=</span> <span class="n">e_right</span><span class="o">/</span><span class="p">(</span><span class="n">q2max</span><span class="o">-</span><span class="n">q2min</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
            <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">q2max</span><span class="o">+</span><span class="n">q2min</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
            <span class="n">dx</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">q2max</span><span class="o">-</span><span class="n">q2min</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="n">dy_lower</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e_left</span><span class="p">)</span>
            <span class="n">dy_upper</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e_right</span><span class="p">)</span>
        <span class="n">kwargs_m</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1"># copy valid for this measurement only</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">or</span> <span class="n">y</span><span class="p">:</span> <span class="c1"># only if a data point exists</span>
            <span class="k">if</span> <span class="n">col_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">m_obj</span><span class="o">.</span><span class="n">experiment</span> <span class="ow">in</span> <span class="n">col_dict</span><span class="p">:</span>
                    <span class="n">col</span> <span class="o">=</span> <span class="n">col_dict</span><span class="p">[</span><span class="n">m_obj</span><span class="o">.</span><span class="n">experiment</span><span class="p">]</span>
                    <span class="n">kwargs_m</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">col</span>
            <span class="k">if</span> <span class="s1">&#39;label&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs_m</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">m_obj</span><span class="o">.</span><span class="n">experiment</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_experiment_labels</span><span class="p">:</span>
                    <span class="c1"># if there is no plot legend entry for the experiment yet,</span>
                    <span class="c1"># add it and add the experiment to the list keeping track</span>
                    <span class="c1"># of existing labels (we don&#39;t want an experiment to appear</span>
                    <span class="c1"># twice in the legend)</span>
                    <span class="n">kwargs_m</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">m_obj</span><span class="o">.</span><span class="n">experiment</span>
                    <span class="n">_experiment_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m_obj</span><span class="o">.</span><span class="n">experiment</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">dy_lower</span><span class="p">,</span> <span class="n">dy_upper</span><span class="p">],</span> <span class="n">xerr</span><span class="o">=</span><span class="n">dx</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_m</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">density_contour_data</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">covariance_factor</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">n_bins</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">n_sigma</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Generate the data for a plot with confidence contours of the density</span>
<span class="sd">    of points (useful for MCMC analyses).</span>

<span class="sd">    Parameters:</span>

<span class="sd">    - `x`, `y`: lists or numpy arrays with the x and y coordinates of the points</span>
<span class="sd">    - `covariance_factor`: optional, numerical factor to tweak the smoothness</span>
<span class="sd">    of the contours. If not specified, estimated using Scott&#39;s/Silverman&#39;s rule.</span>
<span class="sd">    The factor should be between 0 and 1; larger values means more smoothing is</span>
<span class="sd">    applied.</span>
<span class="sd">    - n_bins: number of bins in the histogram created as an intermediate step.</span>
<span class="sd">      this usually does not have to be changed.</span>
<span class="sd">    - n_sigma: integer or iterable of integers specifying the contours</span>
<span class="sd">      corresponding to the number of sigmas to be drawn. For instance, the</span>
<span class="sd">      default (1, 2) draws the contours containing approximately 68 and 95%</span>
<span class="sd">      of the points, respectively.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n_bins</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">n_bins</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="nb">int</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))),</span> <span class="mi">200</span><span class="p">)</span>
    <span class="n">f_binned</span><span class="p">,</span> <span class="n">x_edges</span><span class="p">,</span> <span class="n">y_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">n_bins</span><span class="p">)</span>
    <span class="n">x_centers</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">x_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">/</span><span class="mf">2.</span>
    <span class="n">y_centers</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">y_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">/</span><span class="mf">2.</span>
    <span class="n">x_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x_centers</span><span class="p">)</span>
    <span class="n">y_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y_centers</span><span class="p">)</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span>

    <span class="n">d</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># no. of dimensions</span>

    <span class="k">if</span> <span class="n">covariance_factor</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># Scott&#39;s/Silverman&#39;s rule</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="c1"># no. of data points</span>
        <span class="n">_covariance_factor</span> <span class="o">=</span> <span class="n">n</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mf">6.</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_covariance_factor</span> <span class="o">=</span> <span class="n">covariance_factor</span>

    <span class="n">cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span> <span class="o">*</span> <span class="n">_covariance_factor</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">gaussian_kernel</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="p">[</span><span class="n">x_mean</span><span class="p">,</span> <span class="n">y_mean</span><span class="p">],</span> <span class="n">cov</span><span class="o">=</span><span class="n">cov</span><span class="p">)</span>

    <span class="n">x_grid</span><span class="p">,</span> <span class="n">y_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x_centers</span><span class="p">,</span> <span class="n">y_centers</span><span class="p">)</span>
    <span class="n">xy_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">x_grid</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">y_grid</span><span class="o">.</span><span class="n">ravel</span><span class="p">()])</span>
    <span class="n">f_gauss</span> <span class="o">=</span> <span class="n">gaussian_kernel</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">xy_grid</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="n">f_gauss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">f_gauss</span><span class="p">,</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_centers</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_centers</span><span class="p">)))</span><span class="o">.</span><span class="n">T</span>

    <span class="n">f</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">fftconvolve</span><span class="p">(</span><span class="n">f_binned</span><span class="p">,</span> <span class="n">f_gauss</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="o">/</span><span class="n">f</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">find_confidence_interval</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pdf</span><span class="p">,</span> <span class="n">confidence_level</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">pdf</span><span class="p">[</span><span class="n">pdf</span> <span class="o">&gt;</span> <span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">-</span> <span class="n">confidence_level</span>
    <span class="k">def</span> <span class="nf">get_level</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">brentq</span><span class="p">(</span><span class="n">find_confidence_interval</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span>
                                     <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">confidence_level</span><span class="p">(</span><span class="n">n</span><span class="p">)))</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n_sigma</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
        <span class="n">levels</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_level</span><span class="p">(</span><span class="n">n_sigma</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">levels</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_level</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">n_sigma</span><span class="p">)]</span>

    <span class="c1"># replace negative or zero values by a tiny number before taking the log</span>
    <span class="n">f</span><span class="p">[</span><span class="n">f</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-32</span>
    <span class="c1"># convert probability to -2*log(probability), i.e. a chi^2</span>
    <span class="n">f</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="c1"># convert levels to chi^2 and make the mode equal chi^2=0</span>
    <span class="n">levels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">f</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">x_grid</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">y_grid</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">,</span> <span class="s1">&#39;levels&#39;</span><span class="p">:</span> <span class="n">levels</span><span class="p">}</span>


<span class="k">def</span> <span class="nf">density_contour</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">covariance_factor</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">n_bins</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">n_sigma</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                    <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A plot with confidence contours of the density of points</span>
<span class="sd">    (useful for MCMC analyses).</span>

<span class="sd">    Parameters:</span>

<span class="sd">    - `x`, `y`: lists or numpy arrays with the x and y coordinates of the points</span>
<span class="sd">    - `covariance_factor`: optional, numerical factor to tweak the smoothness</span>
<span class="sd">    of the contours. If not specified, estimated using Scott&#39;s/Silverman&#39;s rule.</span>
<span class="sd">    The factor should be between 0 and 1; larger values means more smoothing is</span>
<span class="sd">    applied.</span>
<span class="sd">    - n_bins: number of bins in the histogram created as an intermediate step.</span>
<span class="sd">      this usually does not have to be changed.</span>
<span class="sd">    - n_sigma: integer or iterable of integers specifying the contours</span>
<span class="sd">      corresponding to the number of sigmas to be drawn. For instance, the</span>
<span class="sd">      default (1, 2) draws the contours containing approximately 68 and 95%</span>
<span class="sd">      of the points, respectively.</span>

<span class="sd">    All remaining keyword arguments are passed to the `contour` function</span>
<span class="sd">    and allow to control the presentation of the plot (see docstring of</span>
<span class="sd">    `flavio.plots.plotfunctions.contour`).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">density_contour_data</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">covariance_factor</span><span class="o">=</span><span class="n">covariance_factor</span><span class="p">,</span>
                                <span class="n">n_bins</span><span class="o">=</span><span class="n">n_bins</span><span class="p">,</span> <span class="n">n_sigma</span><span class="o">=</span><span class="n">n_sigma</span><span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span> <span class="c1">#  since we cannot do **data, **kwargs in Python &lt;3.5</span>
    <span class="k">return</span> <span class="n">contour</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">likelihood_contour_data</span><span class="p">(</span><span class="n">log_likelihood</span><span class="p">,</span> <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span>
              <span class="n">n_sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Generate data required to plot coloured confidence contours (or bands)</span>
<span class="sd">    given a log likelihood function.</span>

<span class="sd">    Parameters:</span>

<span class="sd">    - `log_likelihood`: function returning the logarithm of the likelihood.</span>
<span class="sd">      Can e.g. be the method of the same name of a FastFit instance.</span>
<span class="sd">    - `x_min`, `x_max`, `y_min`, `y_max`: data boundaries</span>
<span class="sd">    - `n_sigma`: plot confidence level corresponding to this number of standard</span>
<span class="sd">      deviations. Either a number (defaults to 1) or a tuple to plot several</span>
<span class="sd">      contours.</span>
<span class="sd">    - `steps`: number of grid steps in each dimension (total computing time is</span>
<span class="sd">      this number squared times the computing time of one `log_likelihood` call!)</span>
<span class="sd">     &quot;&quot;&quot;</span>
    <span class="n">_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">steps</span><span class="p">)</span>
    <span class="n">_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span> <span class="n">steps</span><span class="p">)</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">_x</span><span class="p">,</span> <span class="n">_y</span><span class="p">)</span>
    <span class="nd">@np.vectorize</span>
    <span class="k">def</span> <span class="nf">chi2_vect</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span> <span class="c1"># needed for evaluation on meshgrid</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">log_likelihood</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">])</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">chi2_vect</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">z</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="c1"># subtract the best fit point (on the grid)</span>

    <span class="c1"># get the correct values for 2D confidence/credibility contours for n sigma</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n_sigma</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
        <span class="n">levels</span> <span class="o">=</span> <span class="p">[</span><span class="n">delta_chi2</span><span class="p">(</span><span class="n">n_sigma</span><span class="p">,</span> <span class="n">dof</span><span class="o">=</span><span class="mi">2</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">levels</span> <span class="o">=</span> <span class="p">[</span><span class="n">delta_chi2</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">dof</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">n_sigma</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="n">z</span><span class="p">,</span> <span class="s1">&#39;levels&#39;</span><span class="p">:</span> <span class="n">levels</span><span class="p">}</span>


<span class="k">def</span> <span class="nf">likelihood_contour</span><span class="p">(</span><span class="n">log_likelihood</span><span class="p">,</span> <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span>
              <span class="n">n_sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
              <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Plot coloured confidence contours (or bands) given a log likelihood</span>
<span class="sd">    function.</span>

<span class="sd">    Parameters:</span>

<span class="sd">    - `log_likelihood`: function returning the logarithm of the likelihood.</span>
<span class="sd">      Can e.g. be the method of the same name of a FastFit instance.</span>
<span class="sd">    - `x_min`, `x_max`, `y_min`, `y_max`: data boundaries</span>
<span class="sd">    - `n_sigma`: plot confidence level corresponding to this number of standard</span>
<span class="sd">      deviations. Either a number (defaults to 1) or a tuple to plot several</span>
<span class="sd">      contours.</span>
<span class="sd">    - `steps`: number of grid steps in each dimension (total computing time is</span>
<span class="sd">      this number squared times the computing time of one `log_likelihood` call!)</span>

<span class="sd">    All remaining keyword arguments are passed to the `contour` function</span>
<span class="sd">    and allow to control the presentation of the plot (see docstring of</span>
<span class="sd">    `flavio.plots.plotfunctions.contour`).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">likelihood_contour_data</span><span class="p">(</span><span class="n">log_likelihood</span><span class="o">=</span><span class="n">log_likelihood</span><span class="p">,</span>
                                <span class="n">x_min</span><span class="o">=</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="o">=</span><span class="n">x_max</span><span class="p">,</span>
                                <span class="n">y_min</span><span class="o">=</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="o">=</span><span class="n">y_max</span><span class="p">,</span>
                                <span class="n">n_sigma</span><span class="o">=</span><span class="n">n_sigma</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="n">steps</span><span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span> <span class="c1">#  since we cannot do **data, **kwargs in Python &lt;3.5</span>
    <span class="k">return</span> <span class="n">contour</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># alias for backward compatibility</span>
<span class="k">def</span> <span class="nf">band_plot</span><span class="p">(</span><span class="n">log_likelihood</span><span class="p">,</span> <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span>
              <span class="n">n_sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;This is an alias for `likelihood_contour` which is present for</span>
<span class="sd">    backward compatibility.&quot;&quot;&quot;</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;The `band_plot` function has been replaced &quot;</span>
                  <span class="s2">&quot;by `likelihood_contour` (or &quot;</span>
                  <span class="s2">&quot;`likelihood_contour_data` in conjunction with `contour`) &quot;</span>
                  <span class="s2">&quot;and might be removed in the future. &quot;</span>
                  <span class="s2">&quot;Please update your code.&quot;</span><span class="p">,</span> <span class="ne">FutureWarning</span><span class="p">)</span>
    <span class="n">valid_args</span> <span class="o">=</span> <span class="n">likelihood_contour_data</span><span class="o">.</span><span class="vm">__code__</span><span class="o">.</span><span class="n">co_varnames</span>
    <span class="n">data_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">valid_args</span><span class="p">}</span>
    <span class="k">if</span> <span class="s1">&#39;pre_calculated_z&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">contour_kwargs</span> <span class="o">=</span> <span class="n">likelihood_contour_data</span><span class="p">(</span><span class="n">log_likelihood</span><span class="p">,</span>
                      <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span>
                      <span class="n">n_sigma</span><span class="p">,</span> <span class="n">steps</span><span class="p">,</span> <span class="o">**</span><span class="n">data_kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">contour_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pre_calculated_z&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span>
        <span class="n">_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span> <span class="n">ny</span><span class="p">)</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">_x</span><span class="p">,</span> <span class="n">_y</span><span class="p">)</span>
        <span class="n">contour_kwargs</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
        <span class="n">contour_kwargs</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
        <span class="n">contour_kwargs</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pre_calculated_z&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n_sigma</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
            <span class="n">contour_kwargs</span><span class="p">[</span><span class="s1">&#39;levels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">delta_chi2</span><span class="p">(</span><span class="n">n_sigma</span><span class="p">,</span> <span class="n">dof</span><span class="o">=</span><span class="mi">2</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">contour_kwargs</span><span class="p">[</span><span class="s1">&#39;levels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">delta_chi2</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">dof</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">n_sigma</span><span class="p">]</span>
    <span class="n">valid_args</span> <span class="o">=</span> <span class="n">contour</span><span class="o">.</span><span class="vm">__code__</span><span class="o">.</span><span class="n">co_varnames</span>
    <span class="n">contour_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">valid_args</span><span class="p">})</span>
    <span class="n">contour</span><span class="p">(</span><span class="o">**</span><span class="n">contour_kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">contour_kwargs</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">contour_kwargs</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">contour_kwargs</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">contour</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">levels</span><span class="p">,</span>
              <span class="n">interpolation_factor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
              <span class="n">interpolation_order</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
              <span class="n">col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
              <span class="n">filled</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
              <span class="n">contour_args</span><span class="o">=</span><span class="p">{},</span> <span class="n">contourf_args</span><span class="o">=</span><span class="p">{}):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Plot coloured confidence contours (or bands) given numerical input</span>
<span class="sd">    arrays.</span>

<span class="sd">    Parameters:</span>

<span class="sd">    - `x`, `y`: 2D arrays containg x and y values as returned by numpy.meshgrid</span>
<span class="sd">    - `z` value of the function to plot. 2D array in the same shape as `x` and</span>
<span class="sd">      `y`. The lowest value of the function should be 0 (i.e. the best fit</span>
<span class="sd">      point).</span>
<span class="sd">    - levels: list of function values where to draw the contours. They should</span>
<span class="sd">      be positive and in ascending order.</span>
<span class="sd">    - `interpolation factor` (optional): in between the points on the grid,</span>
<span class="sd">      the functioncan be interpolated to get smoother contours.</span>
<span class="sd">      This parameter sets the number of subdivisions (default: 1, i.e. no</span>
<span class="sd">      interpolation). It should be larger than 1.</span>
<span class="sd">    - `col` (optional): number between 0 and 9 to choose the color of the plot</span>
<span class="sd">      from a predefined palette</span>
<span class="sd">    - `label` (optional): label that will be added to a legend created with</span>
<span class="sd">       maplotlib.pyplot.legend()</span>
<span class="sd">    - `filled` (optional): if False, contours will be drawn without shading</span>
<span class="sd">    - `contour_args`: dictionary of additional options that will be passed</span>
<span class="sd">       to matplotlib.pyplot.contour() (that draws the contour lines)</span>
<span class="sd">    - `contourf_args`: dictionary of additional options that will be passed</span>
<span class="sd">       to matplotlib.pyplot.contourf() (that paints the contour filling).</span>
<span class="sd">       Ignored if `filled` is false.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">interpolation_factor</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">zoom</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="n">interpolation_factor</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">zoom</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="n">interpolation_factor</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">zoom</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="n">interpolation_factor</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">interpolation_order</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">_col</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_col</span> <span class="o">=</span> <span class="n">col</span>
    <span class="n">_contour_args</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">_contourf_args</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">_contour_args</span><span class="p">[</span><span class="s1">&#39;colors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">flavio</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">set1</span><span class="p">[</span><span class="n">_col</span><span class="p">]]</span>
    <span class="k">if</span> <span class="n">filled</span><span class="p">:</span>
        <span class="n">_contour_args</span><span class="p">[</span><span class="s1">&#39;linewidths&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.6</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_contour_args</span><span class="p">[</span><span class="s1">&#39;linewidths&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.8</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span>
    <span class="n">_contourf_args</span><span class="p">[</span><span class="s1">&#39;colors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">flavio</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">pastel</span><span class="p">[</span><span class="n">_col</span><span class="p">]</span> <span class="c1"># RGB</span>
                                       <span class="o">+</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">n</span><span class="o">/</span><span class="n">N</span><span class="p">,</span> <span class="mi">0</span><span class="p">),)</span> <span class="c1"># alpha, decreasing for contours</span>
                                       <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
    <span class="n">_contour_args</span><span class="p">[</span><span class="s1">&#39;linestyles&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;solid&#39;</span>
    <span class="n">_contour_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">contour_args</span><span class="p">)</span>
    <span class="n">_contourf_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">contourf_args</span><span class="p">)</span>
    <span class="c1"># for the filling, need to add zero contour</span>
    <span class="n">levelsf</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">z</span><span class="p">)]</span> <span class="o">+</span> <span class="n">levels</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">filled</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levelsf</span><span class="p">,</span> <span class="o">**</span><span class="n">_contourf_args</span><span class="p">)</span>
    <span class="n">CS</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> <span class="o">**</span><span class="n">_contour_args</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">CS</span><span class="o">.</span><span class="n">collections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">flavio_branding</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.94</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Displays a little box containing &#39;flavio&#39;&quot;&quot;&quot;</span>
    <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">text</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;\textsf{\textbf{flavio}}&#39;</span>
    <span class="k">if</span> <span class="n">version</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="sa">r</span><span class="s1">&#39;\textsf{\scriptsize{ v&#39;</span> <span class="o">+</span> <span class="n">flavio</span><span class="o">.</span><span class="n">__version__</span> <span class="o">+</span> <span class="s1">&#39;}}&#39;</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">flavio_box</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span><span class="p">),</span> <span class="n">x_max</span><span class="o">-</span><span class="n">x_min</span><span class="p">,</span> <span class="n">y_max</span><span class="o">-</span><span class="n">y_min</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;#ffffff&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;#666666&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.7</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">smooth_histogram</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bandwidth</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A smooth histogram based on a Gaussian kernel density estimate.</span>

<span class="sd">    Parameters:</span>

<span class="sd">    - `data`: input array</span>
<span class="sd">    - `bandwidth`: (optional) smoothing bandwidth for the Gaussian kernel</span>

<span class="sd">    The remaining parameters will be passed to `pdf_plot`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kde</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">statistics</span><span class="o">.</span><span class="n">probability</span><span class="o">.</span><span class="n">GaussianKDE</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bandwidth</span><span class="o">=</span><span class="n">bandwidth</span><span class="p">)</span>
    <span class="n">pdf_plot</span><span class="p">(</span><span class="n">kde</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">pdf_plot</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">x_min</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">x_max</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot of a 1D probability density function.</span>

<span class="sd">    Parameters:</span>

<span class="sd">    - `dist`: an instance of ProbabilityDistribution</span>
<span class="sd">    - `x_min`, `x_max`: plot boundaries</span>
<span class="sd">    - steps: optional, number of points (default: 200)</span>

<span class="sd">    The remaining parameters will be passed to `likelihood_plot`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">x_min</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">_x_min</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">support</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">x_max</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">_x_max</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">support</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">_x_min</span><span class="p">,</span> <span class="n">_x_max</span><span class="p">,</span> <span class="n">steps</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">dist</span><span class="o">.</span><span class="n">logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">normed</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fill</span><span class="p">:</span>
        <span class="n">fill_left</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">central_value</span> <span class="o">-</span> <span class="n">dist</span><span class="o">.</span><span class="n">get_error_left</span><span class="p">(</span><span class="s1">&#39;hpd&#39;</span><span class="p">)</span>
        <span class="n">fill_right</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">central_value</span> <span class="o">+</span> <span class="n">dist</span><span class="o">.</span><span class="n">get_error_right</span><span class="p">(</span><span class="s1">&#39;hpd&#39;</span><span class="p">)</span>
        <span class="n">fill_x</span><span class="o">=</span><span class="p">[</span><span class="n">fill_left</span><span class="p">,</span> <span class="n">fill_right</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fill_x</span><span class="o">=</span><span class="bp">None</span>
    <span class="n">likelihood_plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">fill_x</span><span class="o">=</span><span class="n">fill_x</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">likelihood_plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">fill_x</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">plotargs</span><span class="o">=</span><span class="p">{},</span> <span class="n">fillargs</span><span class="o">=</span><span class="p">{}):</span>
    <span class="sd">&quot;&quot;&quot;Plot of a 1D probability density function.</span>

<span class="sd">    Parameters:</span>

<span class="sd">    - `x`: x values</span>
<span class="sd">    - `y`: y values</span>
<span class="sd">    - `col`: (optional) integer to select one of the colours from the default</span>
<span class="sd">      palette</span>
<span class="sd">    - `plotargs`: keyword arguments passed to the `plot` function</span>
<span class="sd">    - `fillargs`: keyword arguments passed to the `fill_between` function</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">_plotargs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">_fillargs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># default values</span>
    <span class="n">_plotargs</span><span class="p">[</span><span class="s1">&#39;linewidth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.6</span>
    <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">_plotargs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">label</span>
    <span class="k">if</span> <span class="n">col</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">_plotargs</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">set1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">_fillargs</span><span class="p">[</span><span class="s1">&#39;facecolor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">pastel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_plotargs</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">set1</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
        <span class="n">_fillargs</span><span class="p">[</span><span class="s1">&#39;facecolor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">pastel</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
    <span class="n">_fillargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fillargs</span><span class="p">)</span>
    <span class="n">_plotargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">plotargs</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">_plotargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fill_x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>
            <span class="n">where</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">fill_x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">fill_x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
            <span class="o">**</span><span class="n">_fillargs</span><span class="p">)</span>
</pre></div>

  </div>

  </header>

  <section id="section-items">

    <h2 class="section-title" id="header-functions">Functions</h2>
      
  <div class="item">
    <div class="name def" id="flavio.plots.plotfunctions.band_plot">
    <p>def <span class="ident">band_plot</span>(</p><p>log_likelihood, x_min, x_max, y_min, y_max, n_sigma=1, steps=20, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>This is an alias for <code>likelihood_contour</code> which is present for
backward compatibility.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.plots.plotfunctions.band_plot', this);">Show source &equiv;</a></p>
  <div id="source-flavio.plots.plotfunctions.band_plot" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">band_plot</span><span class="p">(</span><span class="n">log_likelihood</span><span class="p">,</span> <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span>
              <span class="n">n_sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;This is an alias for `likelihood_contour` which is present for</span>
<span class="sd">    backward compatibility.&quot;&quot;&quot;</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;The `band_plot` function has been replaced &quot;</span>
                  <span class="s2">&quot;by `likelihood_contour` (or &quot;</span>
                  <span class="s2">&quot;`likelihood_contour_data` in conjunction with `contour`) &quot;</span>
                  <span class="s2">&quot;and might be removed in the future. &quot;</span>
                  <span class="s2">&quot;Please update your code.&quot;</span><span class="p">,</span> <span class="ne">FutureWarning</span><span class="p">)</span>
    <span class="n">valid_args</span> <span class="o">=</span> <span class="n">likelihood_contour_data</span><span class="o">.</span><span class="vm">__code__</span><span class="o">.</span><span class="n">co_varnames</span>
    <span class="n">data_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">valid_args</span><span class="p">}</span>
    <span class="k">if</span> <span class="s1">&#39;pre_calculated_z&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">contour_kwargs</span> <span class="o">=</span> <span class="n">likelihood_contour_data</span><span class="p">(</span><span class="n">log_likelihood</span><span class="p">,</span>
                      <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span>
                      <span class="n">n_sigma</span><span class="p">,</span> <span class="n">steps</span><span class="p">,</span> <span class="o">**</span><span class="n">data_kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">contour_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pre_calculated_z&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span>
        <span class="n">_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span> <span class="n">ny</span><span class="p">)</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">_x</span><span class="p">,</span> <span class="n">_y</span><span class="p">)</span>
        <span class="n">contour_kwargs</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
        <span class="n">contour_kwargs</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
        <span class="n">contour_kwargs</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pre_calculated_z&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n_sigma</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
            <span class="n">contour_kwargs</span><span class="p">[</span><span class="s1">&#39;levels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">delta_chi2</span><span class="p">(</span><span class="n">n_sigma</span><span class="p">,</span> <span class="n">dof</span><span class="o">=</span><span class="mi">2</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">contour_kwargs</span><span class="p">[</span><span class="s1">&#39;levels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">delta_chi2</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">dof</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">n_sigma</span><span class="p">]</span>
    <span class="n">valid_args</span> <span class="o">=</span> <span class="n">contour</span><span class="o">.</span><span class="vm">__code__</span><span class="o">.</span><span class="n">co_varnames</span>
    <span class="n">contour_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">valid_args</span><span class="p">})</span>
    <span class="n">contour</span><span class="p">(</span><span class="o">**</span><span class="n">contour_kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">contour_kwargs</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">contour_kwargs</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">contour_kwargs</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="flavio.plots.plotfunctions.contour">
    <p>def <span class="ident">contour</span>(</p><p>x, y, z, levels, interpolation_factor=1, interpolation_order=2, col=0, label=None, filled=True, contour_args={}, contourf_args={})</p>
    </div>
    

    
  
    <div class="desc"><p>Plot coloured confidence contours (or bands) given numerical input
arrays.</p>
<p>Parameters:</p>
<ul>
<li><code>x</code>, <code>y</code>: 2D arrays containg x and y values as returned by numpy.meshgrid</li>
<li><code>z</code> value of the function to plot. 2D array in the same shape as <code>x</code> and
  <code>y</code>. The lowest value of the function should be 0 (i.e. the best fit
  point).</li>
<li>levels: list of function values where to draw the contours. They should
  be positive and in ascending order.</li>
<li><code>interpolation factor</code> (optional): in between the points on the grid,
  the functioncan be interpolated to get smoother contours.
  This parameter sets the number of subdivisions (default: 1, i.e. no
  interpolation). It should be larger than 1.</li>
<li><code>col</code> (optional): number between 0 and 9 to choose the color of the plot
  from a predefined palette</li>
<li><code>label</code> (optional): label that will be added to a legend created with
   maplotlib.pyplot.legend()</li>
<li><code>filled</code> (optional): if False, contours will be drawn without shading</li>
<li><code>contour_args</code>: dictionary of additional options that will be passed
   to matplotlib.pyplot.contour() (that draws the contour lines)</li>
<li><code>contourf_args</code>: dictionary of additional options that will be passed
   to matplotlib.pyplot.contourf() (that paints the contour filling).
   Ignored if <code>filled</code> is false.</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.plots.plotfunctions.contour', this);">Show source &equiv;</a></p>
  <div id="source-flavio.plots.plotfunctions.contour" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">contour</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">levels</span><span class="p">,</span>
              <span class="n">interpolation_factor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
              <span class="n">interpolation_order</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
              <span class="n">col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
              <span class="n">filled</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
              <span class="n">contour_args</span><span class="o">=</span><span class="p">{},</span> <span class="n">contourf_args</span><span class="o">=</span><span class="p">{}):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Plot coloured confidence contours (or bands) given numerical input</span>
<span class="sd">    arrays.</span>

<span class="sd">    Parameters:</span>

<span class="sd">    - `x`, `y`: 2D arrays containg x and y values as returned by numpy.meshgrid</span>
<span class="sd">    - `z` value of the function to plot. 2D array in the same shape as `x` and</span>
<span class="sd">      `y`. The lowest value of the function should be 0 (i.e. the best fit</span>
<span class="sd">      point).</span>
<span class="sd">    - levels: list of function values where to draw the contours. They should</span>
<span class="sd">      be positive and in ascending order.</span>
<span class="sd">    - `interpolation factor` (optional): in between the points on the grid,</span>
<span class="sd">      the functioncan be interpolated to get smoother contours.</span>
<span class="sd">      This parameter sets the number of subdivisions (default: 1, i.e. no</span>
<span class="sd">      interpolation). It should be larger than 1.</span>
<span class="sd">    - `col` (optional): number between 0 and 9 to choose the color of the plot</span>
<span class="sd">      from a predefined palette</span>
<span class="sd">    - `label` (optional): label that will be added to a legend created with</span>
<span class="sd">       maplotlib.pyplot.legend()</span>
<span class="sd">    - `filled` (optional): if False, contours will be drawn without shading</span>
<span class="sd">    - `contour_args`: dictionary of additional options that will be passed</span>
<span class="sd">       to matplotlib.pyplot.contour() (that draws the contour lines)</span>
<span class="sd">    - `contourf_args`: dictionary of additional options that will be passed</span>
<span class="sd">       to matplotlib.pyplot.contourf() (that paints the contour filling).</span>
<span class="sd">       Ignored if `filled` is false.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">interpolation_factor</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">zoom</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="n">interpolation_factor</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">zoom</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="n">interpolation_factor</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">zoom</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="n">interpolation_factor</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">interpolation_order</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">_col</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_col</span> <span class="o">=</span> <span class="n">col</span>
    <span class="n">_contour_args</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">_contourf_args</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">_contour_args</span><span class="p">[</span><span class="s1">&#39;colors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">flavio</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">set1</span><span class="p">[</span><span class="n">_col</span><span class="p">]]</span>
    <span class="k">if</span> <span class="n">filled</span><span class="p">:</span>
        <span class="n">_contour_args</span><span class="p">[</span><span class="s1">&#39;linewidths&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.6</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_contour_args</span><span class="p">[</span><span class="s1">&#39;linewidths&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.8</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span>
    <span class="n">_contourf_args</span><span class="p">[</span><span class="s1">&#39;colors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">flavio</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">pastel</span><span class="p">[</span><span class="n">_col</span><span class="p">]</span> <span class="c1"># RGB</span>
                                       <span class="o">+</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">n</span><span class="o">/</span><span class="n">N</span><span class="p">,</span> <span class="mi">0</span><span class="p">),)</span> <span class="c1"># alpha, decreasing for contours</span>
                                       <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
    <span class="n">_contour_args</span><span class="p">[</span><span class="s1">&#39;linestyles&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;solid&#39;</span>
    <span class="n">_contour_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">contour_args</span><span class="p">)</span>
    <span class="n">_contourf_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">contourf_args</span><span class="p">)</span>
    <span class="c1"># for the filling, need to add zero contour</span>
    <span class="n">levelsf</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">z</span><span class="p">)]</span> <span class="o">+</span> <span class="n">levels</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">filled</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levelsf</span><span class="p">,</span> <span class="o">**</span><span class="n">_contourf_args</span><span class="p">)</span>
    <span class="n">CS</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> <span class="o">**</span><span class="n">_contour_args</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">CS</span><span class="o">.</span><span class="n">collections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="flavio.plots.plotfunctions.density_contour">
    <p>def <span class="ident">density_contour</span>(</p><p>x, y, covariance_factor=None, n_bins=None, n_sigma=(1, 2), **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>A plot with confidence contours of the density of points
(useful for MCMC analyses).</p>
<p>Parameters:</p>
<ul>
<li><code>x</code>, <code>y</code>: lists or numpy arrays with the x and y coordinates of the points</li>
<li><code>covariance_factor</code>: optional, numerical factor to tweak the smoothness
of the contours. If not specified, estimated using Scott's/Silverman's rule.
The factor should be between 0 and 1; larger values means more smoothing is
applied.</li>
<li>n_bins: number of bins in the histogram created as an intermediate step.
  this usually does not have to be changed.</li>
<li>n_sigma: integer or iterable of integers specifying the contours
  corresponding to the number of sigmas to be drawn. For instance, the
  default (1, 2) draws the contours containing approximately 68 and 95%
  of the points, respectively.</li>
</ul>
<p>All remaining keyword arguments are passed to the <code>contour</code> function
and allow to control the presentation of the plot (see docstring of
<a href="#flavio.plots.plotfunctions.contour"><code>contour</code></a>).</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.plots.plotfunctions.density_contour', this);">Show source &equiv;</a></p>
  <div id="source-flavio.plots.plotfunctions.density_contour" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">density_contour</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">covariance_factor</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">n_bins</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">n_sigma</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                    <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A plot with confidence contours of the density of points</span>
<span class="sd">    (useful for MCMC analyses).</span>

<span class="sd">    Parameters:</span>

<span class="sd">    - `x`, `y`: lists or numpy arrays with the x and y coordinates of the points</span>
<span class="sd">    - `covariance_factor`: optional, numerical factor to tweak the smoothness</span>
<span class="sd">    of the contours. If not specified, estimated using Scott&#39;s/Silverman&#39;s rule.</span>
<span class="sd">    The factor should be between 0 and 1; larger values means more smoothing is</span>
<span class="sd">    applied.</span>
<span class="sd">    - n_bins: number of bins in the histogram created as an intermediate step.</span>
<span class="sd">      this usually does not have to be changed.</span>
<span class="sd">    - n_sigma: integer or iterable of integers specifying the contours</span>
<span class="sd">      corresponding to the number of sigmas to be drawn. For instance, the</span>
<span class="sd">      default (1, 2) draws the contours containing approximately 68 and 95%</span>
<span class="sd">      of the points, respectively.</span>

<span class="sd">    All remaining keyword arguments are passed to the `contour` function</span>
<span class="sd">    and allow to control the presentation of the plot (see docstring of</span>
<span class="sd">    `flavio.plots.plotfunctions.contour`).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">density_contour_data</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">covariance_factor</span><span class="o">=</span><span class="n">covariance_factor</span><span class="p">,</span>
                                <span class="n">n_bins</span><span class="o">=</span><span class="n">n_bins</span><span class="p">,</span> <span class="n">n_sigma</span><span class="o">=</span><span class="n">n_sigma</span><span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span> <span class="c1">#  since we cannot do **data, **kwargs in Python &lt;3.5</span>
    <span class="k">return</span> <span class="n">contour</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="flavio.plots.plotfunctions.density_contour_data">
    <p>def <span class="ident">density_contour_data</span>(</p><p>x, y, covariance_factor=None, n_bins=None, n_sigma=(1, 2))</p>
    </div>
    

    
  
    <div class="desc"><p>Generate the data for a plot with confidence contours of the density
of points (useful for MCMC analyses).</p>
<p>Parameters:</p>
<ul>
<li><code>x</code>, <code>y</code>: lists or numpy arrays with the x and y coordinates of the points</li>
<li><code>covariance_factor</code>: optional, numerical factor to tweak the smoothness
of the contours. If not specified, estimated using Scott's/Silverman's rule.
The factor should be between 0 and 1; larger values means more smoothing is
applied.</li>
<li>n_bins: number of bins in the histogram created as an intermediate step.
  this usually does not have to be changed.</li>
<li>n_sigma: integer or iterable of integers specifying the contours
  corresponding to the number of sigmas to be drawn. For instance, the
  default (1, 2) draws the contours containing approximately 68 and 95%
  of the points, respectively.</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.plots.plotfunctions.density_contour_data', this);">Show source &equiv;</a></p>
  <div id="source-flavio.plots.plotfunctions.density_contour_data" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">density_contour_data</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">covariance_factor</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">n_bins</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">n_sigma</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Generate the data for a plot with confidence contours of the density</span>
<span class="sd">    of points (useful for MCMC analyses).</span>

<span class="sd">    Parameters:</span>

<span class="sd">    - `x`, `y`: lists or numpy arrays with the x and y coordinates of the points</span>
<span class="sd">    - `covariance_factor`: optional, numerical factor to tweak the smoothness</span>
<span class="sd">    of the contours. If not specified, estimated using Scott&#39;s/Silverman&#39;s rule.</span>
<span class="sd">    The factor should be between 0 and 1; larger values means more smoothing is</span>
<span class="sd">    applied.</span>
<span class="sd">    - n_bins: number of bins in the histogram created as an intermediate step.</span>
<span class="sd">      this usually does not have to be changed.</span>
<span class="sd">    - n_sigma: integer or iterable of integers specifying the contours</span>
<span class="sd">      corresponding to the number of sigmas to be drawn. For instance, the</span>
<span class="sd">      default (1, 2) draws the contours containing approximately 68 and 95%</span>
<span class="sd">      of the points, respectively.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n_bins</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">n_bins</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="nb">int</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))),</span> <span class="mi">200</span><span class="p">)</span>
    <span class="n">f_binned</span><span class="p">,</span> <span class="n">x_edges</span><span class="p">,</span> <span class="n">y_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">n_bins</span><span class="p">)</span>
    <span class="n">x_centers</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">x_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">/</span><span class="mf">2.</span>
    <span class="n">y_centers</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">y_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">/</span><span class="mf">2.</span>
    <span class="n">x_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x_centers</span><span class="p">)</span>
    <span class="n">y_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y_centers</span><span class="p">)</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span>

    <span class="n">d</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># no. of dimensions</span>

    <span class="k">if</span> <span class="n">covariance_factor</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># Scott&#39;s/Silverman&#39;s rule</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="c1"># no. of data points</span>
        <span class="n">_covariance_factor</span> <span class="o">=</span> <span class="n">n</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mf">6.</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_covariance_factor</span> <span class="o">=</span> <span class="n">covariance_factor</span>

    <span class="n">cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span> <span class="o">*</span> <span class="n">_covariance_factor</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">gaussian_kernel</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="p">[</span><span class="n">x_mean</span><span class="p">,</span> <span class="n">y_mean</span><span class="p">],</span> <span class="n">cov</span><span class="o">=</span><span class="n">cov</span><span class="p">)</span>

    <span class="n">x_grid</span><span class="p">,</span> <span class="n">y_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x_centers</span><span class="p">,</span> <span class="n">y_centers</span><span class="p">)</span>
    <span class="n">xy_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">x_grid</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">y_grid</span><span class="o">.</span><span class="n">ravel</span><span class="p">()])</span>
    <span class="n">f_gauss</span> <span class="o">=</span> <span class="n">gaussian_kernel</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">xy_grid</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="n">f_gauss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">f_gauss</span><span class="p">,</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_centers</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_centers</span><span class="p">)))</span><span class="o">.</span><span class="n">T</span>

    <span class="n">f</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">fftconvolve</span><span class="p">(</span><span class="n">f_binned</span><span class="p">,</span> <span class="n">f_gauss</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="o">/</span><span class="n">f</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">find_confidence_interval</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pdf</span><span class="p">,</span> <span class="n">confidence_level</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">pdf</span><span class="p">[</span><span class="n">pdf</span> <span class="o">&gt;</span> <span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">-</span> <span class="n">confidence_level</span>
    <span class="k">def</span> <span class="nf">get_level</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">brentq</span><span class="p">(</span><span class="n">find_confidence_interval</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span>
                                     <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">confidence_level</span><span class="p">(</span><span class="n">n</span><span class="p">)))</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n_sigma</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
        <span class="n">levels</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_level</span><span class="p">(</span><span class="n">n_sigma</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">levels</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_level</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">n_sigma</span><span class="p">)]</span>

    <span class="c1"># replace negative or zero values by a tiny number before taking the log</span>
    <span class="n">f</span><span class="p">[</span><span class="n">f</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-32</span>
    <span class="c1"># convert probability to -2*log(probability), i.e. a chi^2</span>
    <span class="n">f</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="c1"># convert levels to chi^2 and make the mode equal chi^2=0</span>
    <span class="n">levels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">f</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">x_grid</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">y_grid</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">,</span> <span class="s1">&#39;levels&#39;</span><span class="p">:</span> <span class="n">levels</span><span class="p">}</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="flavio.plots.plotfunctions.error_budget_pie">
    <p>def <span class="ident">error_budget_pie</span>(</p><p>err_dict, other_cutoff=0.03)</p>
    </div>
    

    
  
    <div class="desc"><p>Pie chart of an observable's error budget.</p>
<p>Parameters:</p>
<ul>
<li><code>err_dict</code>: Dictionary as return from <code>flavio.sm_error_budget</code></li>
<li><code>other_cutoff</code>: If an individual error contribution divided by the total
  error is smaller than this number, it is lumped under "other". Defaults
  to 0.03.</li>
</ul>
<p>Note that for uncorrelated parameters, the total uncertainty is the squared
sum of the individual uncertainties, so the relative size of the wedges does
not correspond to the relative contribution to the total uncertainty.</p>
<p>If the uncertainties of individual parameters are correlated, the total
uncertainty can be larger or smaller than the squared sum of the individual
uncertainties, so the representation can be misleading.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.plots.plotfunctions.error_budget_pie', this);">Show source &equiv;</a></p>
  <div id="source-flavio.plots.plotfunctions.error_budget_pie" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">error_budget_pie</span><span class="p">(</span><span class="n">err_dict</span><span class="p">,</span> <span class="n">other_cutoff</span><span class="o">=</span><span class="mf">0.03</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Pie chart of an observable&#39;s error budget.</span>

<span class="sd">    Parameters:</span>

<span class="sd">    - `err_dict`: Dictionary as return from `flavio.sm_error_budget`</span>
<span class="sd">    - `other_cutoff`: If an individual error contribution divided by the total</span>
<span class="sd">      error is smaller than this number, it is lumped under &quot;other&quot;. Defaults</span>
<span class="sd">      to 0.03.</span>

<span class="sd">    Note that for uncorrelated parameters, the total uncertainty is the squared</span>
<span class="sd">    sum of the individual uncertainties, so the relative size of the wedges does</span>
<span class="sd">    not correspond to the relative contribution to the total uncertainty.</span>

<span class="sd">    If the uncertainties of individual parameters are correlated, the total</span>
<span class="sd">    uncertainty can be larger or smaller than the squared sum of the individual</span>
<span class="sd">    uncertainties, so the representation can be misleading.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">err_tot</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">err_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="n">err_dict_sorted</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">err_dict</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="o">-</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">fracs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">small_frac</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">err_dict_sorted</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">frac</span> <span class="o">=</span> <span class="n">value</span><span class="o">/</span><span class="n">err_tot</span>
        <span class="k">if</span> <span class="n">frac</span> <span class="o">&gt;</span> <span class="n">other_cutoff</span><span class="p">:</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flavio</span><span class="o">.</span><span class="n">Parameter</span><span class="o">.</span><span class="n">get_instance</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">tex</span><span class="p">)</span>
            <span class="n">fracs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frac</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">small_frac</span> <span class="o">+=</span> <span class="n">frac</span>
    <span class="k">if</span> <span class="n">small_frac</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;other&#39;</span><span class="p">)</span>
        <span class="n">fracs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">small_frac</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">my_autopct</span><span class="p">(</span><span class="n">pct</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;{p:.1f}\%&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">pct</span><span class="o">*</span><span class="n">err_tot</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">fracs</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">autopct</span><span class="o">=</span><span class="n">my_autopct</span><span class="p">,</span> <span class="n">wedgeprops</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;linewidth&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">},</span> <span class="n">colors</span><span class="o">=</span><span class="n">flavio</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">pastel</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="flavio.plots.plotfunctions.flavio_box">
    <p>def <span class="ident">flavio_box</span>(</p><p>x_min, x_max, y_min, y_max)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.plots.plotfunctions.flavio_box', this);">Show source &equiv;</a></p>
  <div id="source-flavio.plots.plotfunctions.flavio_box" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">flavio_box</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span><span class="p">),</span> <span class="n">x_max</span><span class="o">-</span><span class="n">x_min</span><span class="p">,</span> <span class="n">y_max</span><span class="o">-</span><span class="n">y_min</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;#ffffff&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;#666666&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.7</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="flavio.plots.plotfunctions.flavio_branding">
    <p>def <span class="ident">flavio_branding</span>(</p><p>x=0.8, y=0.94, version=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Displays a little box containing 'flavio'</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.plots.plotfunctions.flavio_branding', this);">Show source &equiv;</a></p>
  <div id="source-flavio.plots.plotfunctions.flavio_branding" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">flavio_branding</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.94</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Displays a little box containing &#39;flavio&#39;&quot;&quot;&quot;</span>
    <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">text</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;\textsf{\textbf{flavio}}&#39;</span>
    <span class="k">if</span> <span class="n">version</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="sa">r</span><span class="s1">&#39;\textsf{\scriptsize{ v&#39;</span> <span class="o">+</span> <span class="n">flavio</span><span class="o">.</span><span class="n">__version__</span> <span class="o">+</span> <span class="s1">&#39;}}&#39;</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="flavio.plots.plotfunctions.likelihood_contour">
    <p>def <span class="ident">likelihood_contour</span>(</p><p>log_likelihood, x_min, x_max, y_min, y_max, n_sigma=1, steps=20, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Plot coloured confidence contours (or bands) given a log likelihood
function.</p>
<p>Parameters:</p>
<ul>
<li><code>log_likelihood</code>: function returning the logarithm of the likelihood.
  Can e.g. be the method of the same name of a FastFit instance.</li>
<li><code>x_min</code>, <code>x_max</code>, <code>y_min</code>, <code>y_max</code>: data boundaries</li>
<li><code>n_sigma</code>: plot confidence level corresponding to this number of standard
  deviations. Either a number (defaults to 1) or a tuple to plot several
  contours.</li>
<li><code>steps</code>: number of grid steps in each dimension (total computing time is
  this number squared times the computing time of one <code>log_likelihood</code> call!)</li>
</ul>
<p>All remaining keyword arguments are passed to the <code>contour</code> function
and allow to control the presentation of the plot (see docstring of
<a href="#flavio.plots.plotfunctions.contour"><code>contour</code></a>).</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.plots.plotfunctions.likelihood_contour', this);">Show source &equiv;</a></p>
  <div id="source-flavio.plots.plotfunctions.likelihood_contour" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">likelihood_contour</span><span class="p">(</span><span class="n">log_likelihood</span><span class="p">,</span> <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span>
              <span class="n">n_sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
              <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Plot coloured confidence contours (or bands) given a log likelihood</span>
<span class="sd">    function.</span>

<span class="sd">    Parameters:</span>

<span class="sd">    - `log_likelihood`: function returning the logarithm of the likelihood.</span>
<span class="sd">      Can e.g. be the method of the same name of a FastFit instance.</span>
<span class="sd">    - `x_min`, `x_max`, `y_min`, `y_max`: data boundaries</span>
<span class="sd">    - `n_sigma`: plot confidence level corresponding to this number of standard</span>
<span class="sd">      deviations. Either a number (defaults to 1) or a tuple to plot several</span>
<span class="sd">      contours.</span>
<span class="sd">    - `steps`: number of grid steps in each dimension (total computing time is</span>
<span class="sd">      this number squared times the computing time of one `log_likelihood` call!)</span>

<span class="sd">    All remaining keyword arguments are passed to the `contour` function</span>
<span class="sd">    and allow to control the presentation of the plot (see docstring of</span>
<span class="sd">    `flavio.plots.plotfunctions.contour`).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">likelihood_contour_data</span><span class="p">(</span><span class="n">log_likelihood</span><span class="o">=</span><span class="n">log_likelihood</span><span class="p">,</span>
                                <span class="n">x_min</span><span class="o">=</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="o">=</span><span class="n">x_max</span><span class="p">,</span>
                                <span class="n">y_min</span><span class="o">=</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="o">=</span><span class="n">y_max</span><span class="p">,</span>
                                <span class="n">n_sigma</span><span class="o">=</span><span class="n">n_sigma</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="n">steps</span><span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span> <span class="c1">#  since we cannot do **data, **kwargs in Python &lt;3.5</span>
    <span class="k">return</span> <span class="n">contour</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="flavio.plots.plotfunctions.likelihood_contour_data">
    <p>def <span class="ident">likelihood_contour_data</span>(</p><p>log_likelihood, x_min, x_max, y_min, y_max, n_sigma=1, steps=20)</p>
    </div>
    

    
  
    <div class="desc"><p>Generate data required to plot coloured confidence contours (or bands)
given a log likelihood function.</p>
<p>Parameters:</p>
<ul>
<li><code>log_likelihood</code>: function returning the logarithm of the likelihood.
  Can e.g. be the method of the same name of a FastFit instance.</li>
<li><code>x_min</code>, <code>x_max</code>, <code>y_min</code>, <code>y_max</code>: data boundaries</li>
<li><code>n_sigma</code>: plot confidence level corresponding to this number of standard
  deviations. Either a number (defaults to 1) or a tuple to plot several
  contours.</li>
<li><code>steps</code>: number of grid steps in each dimension (total computing time is
  this number squared times the computing time of one <code>log_likelihood</code> call!)</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.plots.plotfunctions.likelihood_contour_data', this);">Show source &equiv;</a></p>
  <div id="source-flavio.plots.plotfunctions.likelihood_contour_data" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">likelihood_contour_data</span><span class="p">(</span><span class="n">log_likelihood</span><span class="p">,</span> <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span>
              <span class="n">n_sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Generate data required to plot coloured confidence contours (or bands)</span>
<span class="sd">    given a log likelihood function.</span>

<span class="sd">    Parameters:</span>

<span class="sd">    - `log_likelihood`: function returning the logarithm of the likelihood.</span>
<span class="sd">      Can e.g. be the method of the same name of a FastFit instance.</span>
<span class="sd">    - `x_min`, `x_max`, `y_min`, `y_max`: data boundaries</span>
<span class="sd">    - `n_sigma`: plot confidence level corresponding to this number of standard</span>
<span class="sd">      deviations. Either a number (defaults to 1) or a tuple to plot several</span>
<span class="sd">      contours.</span>
<span class="sd">    - `steps`: number of grid steps in each dimension (total computing time is</span>
<span class="sd">      this number squared times the computing time of one `log_likelihood` call!)</span>
<span class="sd">     &quot;&quot;&quot;</span>
    <span class="n">_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">steps</span><span class="p">)</span>
    <span class="n">_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span> <span class="n">steps</span><span class="p">)</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">_x</span><span class="p">,</span> <span class="n">_y</span><span class="p">)</span>
    <span class="nd">@np.vectorize</span>
    <span class="k">def</span> <span class="nf">chi2_vect</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span> <span class="c1"># needed for evaluation on meshgrid</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">log_likelihood</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">])</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">chi2_vect</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">z</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="c1"># subtract the best fit point (on the grid)</span>

    <span class="c1"># get the correct values for 2D confidence/credibility contours for n sigma</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n_sigma</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
        <span class="n">levels</span> <span class="o">=</span> <span class="p">[</span><span class="n">delta_chi2</span><span class="p">(</span><span class="n">n_sigma</span><span class="p">,</span> <span class="n">dof</span><span class="o">=</span><span class="mi">2</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">levels</span> <span class="o">=</span> <span class="p">[</span><span class="n">delta_chi2</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">dof</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">n_sigma</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="n">z</span><span class="p">,</span> <span class="s1">&#39;levels&#39;</span><span class="p">:</span> <span class="n">levels</span><span class="p">}</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="flavio.plots.plotfunctions.likelihood_plot">
    <p>def <span class="ident">likelihood_plot</span>(</p><p>x, y, fill_x=None, col=None, label=None, plotargs={}, fillargs={})</p>
    </div>
    

    
  
    <div class="desc"><p>Plot of a 1D probability density function.</p>
<p>Parameters:</p>
<ul>
<li><code>x</code>: x values</li>
<li><code>y</code>: y values</li>
<li><code>col</code>: (optional) integer to select one of the colours from the default
  palette</li>
<li><code>plotargs</code>: keyword arguments passed to the <code>plot</code> function</li>
<li><code>fillargs</code>: keyword arguments passed to the <code>fill_between</code> function</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.plots.plotfunctions.likelihood_plot', this);">Show source &equiv;</a></p>
  <div id="source-flavio.plots.plotfunctions.likelihood_plot" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">likelihood_plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">fill_x</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">plotargs</span><span class="o">=</span><span class="p">{},</span> <span class="n">fillargs</span><span class="o">=</span><span class="p">{}):</span>
    <span class="sd">&quot;&quot;&quot;Plot of a 1D probability density function.</span>

<span class="sd">    Parameters:</span>

<span class="sd">    - `x`: x values</span>
<span class="sd">    - `y`: y values</span>
<span class="sd">    - `col`: (optional) integer to select one of the colours from the default</span>
<span class="sd">      palette</span>
<span class="sd">    - `plotargs`: keyword arguments passed to the `plot` function</span>
<span class="sd">    - `fillargs`: keyword arguments passed to the `fill_between` function</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">_plotargs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">_fillargs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># default values</span>
    <span class="n">_plotargs</span><span class="p">[</span><span class="s1">&#39;linewidth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.6</span>
    <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">_plotargs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">label</span>
    <span class="k">if</span> <span class="n">col</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">_plotargs</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">set1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">_fillargs</span><span class="p">[</span><span class="s1">&#39;facecolor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">pastel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_plotargs</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">set1</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
        <span class="n">_fillargs</span><span class="p">[</span><span class="s1">&#39;facecolor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">pastel</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
    <span class="n">_fillargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fillargs</span><span class="p">)</span>
    <span class="n">_plotargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">plotargs</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">_plotargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fill_x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>
            <span class="n">where</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">fill_x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">fill_x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
            <span class="o">**</span><span class="n">_fillargs</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="flavio.plots.plotfunctions.pdf_plot">
    <p>def <span class="ident">pdf_plot</span>(</p><p>dist, x_min=None, x_max=None, fill=True, steps=200, normed=True, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Plot of a 1D probability density function.</p>
<p>Parameters:</p>
<ul>
<li><code>dist</code>: an instance of ProbabilityDistribution</li>
<li><code>x_min</code>, <code>x_max</code>: plot boundaries</li>
<li>steps: optional, number of points (default: 200)</li>
</ul>
<p>The remaining parameters will be passed to <code>likelihood_plot</code>.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.plots.plotfunctions.pdf_plot', this);">Show source &equiv;</a></p>
  <div id="source-flavio.plots.plotfunctions.pdf_plot" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">pdf_plot</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">x_min</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">x_max</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot of a 1D probability density function.</span>

<span class="sd">    Parameters:</span>

<span class="sd">    - `dist`: an instance of ProbabilityDistribution</span>
<span class="sd">    - `x_min`, `x_max`: plot boundaries</span>
<span class="sd">    - steps: optional, number of points (default: 200)</span>

<span class="sd">    The remaining parameters will be passed to `likelihood_plot`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">x_min</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">_x_min</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">support</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">x_max</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">_x_max</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">support</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">_x_min</span><span class="p">,</span> <span class="n">_x_max</span><span class="p">,</span> <span class="n">steps</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">dist</span><span class="o">.</span><span class="n">logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">normed</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fill</span><span class="p">:</span>
        <span class="n">fill_left</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">central_value</span> <span class="o">-</span> <span class="n">dist</span><span class="o">.</span><span class="n">get_error_left</span><span class="p">(</span><span class="s1">&#39;hpd&#39;</span><span class="p">)</span>
        <span class="n">fill_right</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">central_value</span> <span class="o">+</span> <span class="n">dist</span><span class="o">.</span><span class="n">get_error_right</span><span class="p">(</span><span class="s1">&#39;hpd&#39;</span><span class="p">)</span>
        <span class="n">fill_x</span><span class="o">=</span><span class="p">[</span><span class="n">fill_left</span><span class="p">,</span> <span class="n">fill_right</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fill_x</span><span class="o">=</span><span class="bp">None</span>
    <span class="n">likelihood_plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">fill_x</span><span class="o">=</span><span class="n">fill_x</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="flavio.plots.plotfunctions.q2_plot_exp">
    <p>def <span class="ident">q2_plot_exp</span>(</p><p>obs_name, col_dict=None, divide_binwidth=False, include_measurements=None, include_bins=None, exclude_bins=None, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Plot all existing experimental measurements of a $q^2$-dependent
observable as a function of $q^2$  (in the form of coloured crosses).</p>
<p>Parameters:</p>
<ul>
<li><code>col_dict</code> (optional): a dictionary to assign colours to specific
  experiments, e.g. <code>{'BaBar': 'b', 'Belle': 'r'}</code></li>
<li><code>divide_binwidth</code> (optional): this should be set to True when comparing
  integrated branching ratios from experiments with different bin widths
  or to theory predictions for a differential branching ratio. It will
  divide all values and uncertainties by the bin width (i.e. dimensionless
  integrated BRs will be converted to integrated differential BRs with
  dimensions of GeV$^{-2}$). Defaults to False.</li>
<li><code>include_measurements</code> (optional): a list of strings with measurement
  names (see measurements.yml) to include in the plot. By default, all
  existing measurements will be included.</li>
<li><code>include_bins</code> (optional): a list of bins (as tuples of the bin
  boundaries) to include in the plot. By default, all measured bins
  will be included. Should not be specified simultaneously with
  <code>exclude_bins</code>.</li>
<li><code>exclude_bins</code> (optional): a list of bins (as tuples of the bin
  boundaries) not to include in the plot. By default, all measured bins
  will be included. Should not be specified simultaneously with
  <code>include_bins</code>.</li>
</ul>
<p>Additional keyword arguments are passed to the matplotlib errorbar function,
e.g. 'c' for colour.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.plots.plotfunctions.q2_plot_exp', this);">Show source &equiv;</a></p>
  <div id="source-flavio.plots.plotfunctions.q2_plot_exp" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">q2_plot_exp</span><span class="p">(</span><span class="n">obs_name</span><span class="p">,</span> <span class="n">col_dict</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">divide_binwidth</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">include_measurements</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                <span class="n">include_bins</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">exclude_bins</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Plot all existing experimental measurements of a $q^2$-dependent</span>
<span class="sd">    observable as a function of $q^2$  (in the form of coloured crosses).</span>

<span class="sd">    Parameters:</span>

<span class="sd">    - `col_dict` (optional): a dictionary to assign colours to specific</span>
<span class="sd">      experiments, e.g. `{&#39;BaBar&#39;: &#39;b&#39;, &#39;Belle&#39;: &#39;r&#39;}`</span>
<span class="sd">    - `divide_binwidth` (optional): this should be set to True when comparing</span>
<span class="sd">      integrated branching ratios from experiments with different bin widths</span>
<span class="sd">      or to theory predictions for a differential branching ratio. It will</span>
<span class="sd">      divide all values and uncertainties by the bin width (i.e. dimensionless</span>
<span class="sd">      integrated BRs will be converted to integrated differential BRs with</span>
<span class="sd">      dimensions of GeV$^{-2}$). Defaults to False.</span>
<span class="sd">    - `include_measurements` (optional): a list of strings with measurement</span>
<span class="sd">      names (see measurements.yml) to include in the plot. By default, all</span>
<span class="sd">      existing measurements will be included.</span>
<span class="sd">    - `include_bins` (optional): a list of bins (as tuples of the bin</span>
<span class="sd">      boundaries) to include in the plot. By default, all measured bins</span>
<span class="sd">      will be included. Should not be specified simultaneously with</span>
<span class="sd">      `exclude_bins`.</span>
<span class="sd">    - `exclude_bins` (optional): a list of bins (as tuples of the bin</span>
<span class="sd">      boundaries) not to include in the plot. By default, all measured bins</span>
<span class="sd">      will be included. Should not be specified simultaneously with</span>
<span class="sd">      `include_bins`.</span>

<span class="sd">    Additional keyword arguments are passed to the matplotlib errorbar function,</span>
<span class="sd">    e.g. &#39;c&#39; for colour.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">obs</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Observable</span><span class="o">.</span><span class="n">get_instance</span><span class="p">(</span><span class="n">obs_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">obs</span><span class="o">.</span><span class="n">arguments</span> <span class="o">!=</span> <span class="p">[</span><span class="s1">&#39;q2min&#39;</span><span class="p">,</span> <span class="s1">&#39;q2max&#39;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Only observables that depend on q2min and q2max (and nothing else) are allowed&quot;</span><span class="p">)</span>
    <span class="n">_experiment_labels</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># list of experiments appearing in the plot legend</span>
    <span class="k">for</span> <span class="n">m_name</span><span class="p">,</span> <span class="n">m_obj</span> <span class="ow">in</span> <span class="n">flavio</span><span class="o">.</span><span class="n">Measurement</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">include_measurements</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">m_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">include_measurements</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">obs_name_list</span> <span class="o">=</span> <span class="n">m_obj</span><span class="o">.</span><span class="n">all_parameters</span>
        <span class="n">obs_name_list_binned</span> <span class="o">=</span> <span class="p">[</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obs_name_list</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="n">obs_name</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">obs_name_list_binned</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">central</span> <span class="o">=</span> <span class="n">m_obj</span><span class="o">.</span><span class="n">get_central_all</span><span class="p">()</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">m_obj</span><span class="o">.</span><span class="n">get_1d_errors_rightleft</span><span class="p">()</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dy_lower</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dy_upper</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">q2min</span><span class="p">,</span> <span class="n">q2max</span> <span class="ow">in</span> <span class="n">obs_name_list_binned</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">include_bins</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">exclude_bins</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please only specify include_bins or exclude_bins, not both&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">q2min</span><span class="p">,</span> <span class="n">q2max</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">include_bins</span><span class="p">:</span>
                    <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">exclude_bins</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">q2min</span><span class="p">,</span> <span class="n">q2max</span><span class="p">)</span> <span class="ow">in</span> <span class="n">exclude_bins</span><span class="p">:</span>
                    <span class="k">continue</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">central</span><span class="p">[(</span><span class="n">obs_name</span><span class="p">,</span> <span class="n">q2min</span><span class="p">,</span> <span class="n">q2max</span><span class="p">)]</span>
            <span class="n">e_right</span><span class="p">,</span> <span class="n">e_left</span> <span class="o">=</span> <span class="n">err</span><span class="p">[(</span><span class="n">obs_name</span><span class="p">,</span> <span class="n">q2min</span><span class="p">,</span> <span class="n">q2max</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">divide_binwidth</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="o">/</span><span class="p">(</span><span class="n">q2max</span><span class="o">-</span><span class="n">q2min</span><span class="p">)</span>
                <span class="n">e_left</span> <span class="o">=</span> <span class="n">e_left</span><span class="o">/</span><span class="p">(</span><span class="n">q2max</span><span class="o">-</span><span class="n">q2min</span><span class="p">)</span>
                <span class="n">e_right</span> <span class="o">=</span> <span class="n">e_right</span><span class="o">/</span><span class="p">(</span><span class="n">q2max</span><span class="o">-</span><span class="n">q2min</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
            <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">q2max</span><span class="o">+</span><span class="n">q2min</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
            <span class="n">dx</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">q2max</span><span class="o">-</span><span class="n">q2min</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="n">dy_lower</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e_left</span><span class="p">)</span>
            <span class="n">dy_upper</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e_right</span><span class="p">)</span>
        <span class="n">kwargs_m</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1"># copy valid for this measurement only</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">or</span> <span class="n">y</span><span class="p">:</span> <span class="c1"># only if a data point exists</span>
            <span class="k">if</span> <span class="n">col_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">m_obj</span><span class="o">.</span><span class="n">experiment</span> <span class="ow">in</span> <span class="n">col_dict</span><span class="p">:</span>
                    <span class="n">col</span> <span class="o">=</span> <span class="n">col_dict</span><span class="p">[</span><span class="n">m_obj</span><span class="o">.</span><span class="n">experiment</span><span class="p">]</span>
                    <span class="n">kwargs_m</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">col</span>
            <span class="k">if</span> <span class="s1">&#39;label&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs_m</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">m_obj</span><span class="o">.</span><span class="n">experiment</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_experiment_labels</span><span class="p">:</span>
                    <span class="c1"># if there is no plot legend entry for the experiment yet,</span>
                    <span class="c1"># add it and add the experiment to the list keeping track</span>
                    <span class="c1"># of existing labels (we don&#39;t want an experiment to appear</span>
                    <span class="c1"># twice in the legend)</span>
                    <span class="n">kwargs_m</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">m_obj</span><span class="o">.</span><span class="n">experiment</span>
                    <span class="n">_experiment_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m_obj</span><span class="o">.</span><span class="n">experiment</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">dy_lower</span><span class="p">,</span> <span class="n">dy_upper</span><span class="p">],</span> <span class="n">xerr</span><span class="o">=</span><span class="n">dx</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_m</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="flavio.plots.plotfunctions.q2_plot_th_bin">
    <p>def <span class="ident">q2_plot_th_bin</span>(</p><p>obs_name, bin_list, wc=None, divide_binwidth=False, N=50, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Plot the binned theory prediction with uncertainties of a
$q^2$-dependent observable as a function of $q^2$  (in the form of coloured
boxes).</p>
<p>Parameters:</p>
<ul>
<li><code>bin_list</code>: a list of tuples containing bin boundaries</li>
<li><code>wc</code> (optional): <code>WilsonCoefficient</code> instance to define beyond-the-SM
  Wilson coefficients</li>
<li><code>divide_binwidth</code> (optional): this should be set to True when comparing
  integrated branching ratios from experiments with different bin widths
  or to theory predictions for a differential branching ratio. It will
  divide all values and uncertainties by the bin width (i.e. dimensionless
  integrated BRs will be converted to integrated differential BRs with
  dimensions of GeV$^{-2}$). Defaults to False.</li>
<li><code>N</code> (optional): number of random draws to determine the uncertainty.
  Defaults to 50. Larger is slower but more precise. The relative
  error of the theory uncertainty scales as $1/\sqrt{2N}$.</li>
</ul>
<p>Additional keyword arguments are passed to the matplotlib add_patch function,
e.g. 'fc' for face colour.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.plots.plotfunctions.q2_plot_th_bin', this);">Show source &equiv;</a></p>
  <div id="source-flavio.plots.plotfunctions.q2_plot_th_bin" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">q2_plot_th_bin</span><span class="p">(</span><span class="n">obs_name</span><span class="p">,</span> <span class="n">bin_list</span><span class="p">,</span> <span class="n">wc</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">divide_binwidth</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Plot the binned theory prediction with uncertainties of a</span>
<span class="sd">    $q^2$-dependent observable as a function of $q^2$  (in the form of coloured</span>
<span class="sd">    boxes).</span>

<span class="sd">    Parameters:</span>

<span class="sd">    - `bin_list`: a list of tuples containing bin boundaries</span>
<span class="sd">    - `wc` (optional): `WilsonCoefficient` instance to define beyond-the-SM</span>
<span class="sd">      Wilson coefficients</span>
<span class="sd">    - `divide_binwidth` (optional): this should be set to True when comparing</span>
<span class="sd">      integrated branching ratios from experiments with different bin widths</span>
<span class="sd">      or to theory predictions for a differential branching ratio. It will</span>
<span class="sd">      divide all values and uncertainties by the bin width (i.e. dimensionless</span>
<span class="sd">      integrated BRs will be converted to integrated differential BRs with</span>
<span class="sd">      dimensions of GeV$^{-2}$). Defaults to False.</span>
<span class="sd">    - `N` (optional): number of random draws to determine the uncertainty.</span>
<span class="sd">      Defaults to 50. Larger is slower but more precise. The relative</span>
<span class="sd">      error of the theory uncertainty scales as $1/\sqrt{2N}$.</span>

<span class="sd">    Additional keyword arguments are passed to the matplotlib add_patch function,</span>
<span class="sd">    e.g. &#39;fc&#39; for face colour.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">obs</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Observable</span><span class="o">.</span><span class="n">get_instance</span><span class="p">(</span><span class="n">obs_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">obs</span><span class="o">.</span><span class="n">arguments</span> <span class="o">!=</span> <span class="p">[</span><span class="s1">&#39;q2min&#39;</span><span class="p">,</span> <span class="s1">&#39;q2max&#39;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Only observables that depend on q2min and q2max (and nothing else) are allowed&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">wc</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">wc</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">WilsonCoefficients</span><span class="p">()</span> <span class="c1"># SM Wilson coefficients</span>
        <span class="n">obs_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">bin_</span><span class="p">:</span> <span class="n">flavio</span><span class="o">.</span><span class="n">sm_prediction</span><span class="p">(</span><span class="n">obs_name</span><span class="p">,</span> <span class="o">*</span><span class="n">bin_</span><span class="p">)</span> <span class="k">for</span> <span class="n">bin_</span> <span class="ow">in</span> <span class="n">bin_list</span><span class="p">}</span>
        <span class="n">obs_err_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">bin_</span><span class="p">:</span> <span class="n">flavio</span><span class="o">.</span><span class="n">sm_uncertainty</span><span class="p">(</span><span class="n">obs_name</span><span class="p">,</span> <span class="o">*</span><span class="n">bin_</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="n">N</span><span class="p">)</span> <span class="k">for</span> <span class="n">bin_</span> <span class="ow">in</span> <span class="n">bin_list</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">obs_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">bin_</span><span class="p">:</span><span class="n">flavio</span><span class="o">.</span><span class="n">np_prediction</span><span class="p">(</span><span class="n">obs_name</span><span class="p">,</span> <span class="n">wc</span><span class="p">,</span> <span class="o">*</span><span class="n">bin_</span><span class="p">)</span> <span class="k">for</span> <span class="n">bin_</span> <span class="ow">in</span> <span class="n">bin_list</span><span class="p">}</span>
        <span class="n">obs_err_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">bin_</span><span class="p">:</span> <span class="n">flavio</span><span class="o">.</span><span class="n">np_uncertainty</span><span class="p">(</span><span class="n">obs_name</span><span class="p">,</span> <span class="n">wc</span><span class="p">,</span> <span class="o">*</span><span class="n">bin_</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="n">N</span><span class="p">)</span> <span class="k">for</span> <span class="n">bin_</span> <span class="ow">in</span> <span class="n">bin_list</span><span class="p">}</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">_i</span><span class="p">,</span> <span class="p">(</span><span class="n">bin_</span><span class="p">,</span> <span class="n">central_</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">obs_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="n">q2min</span><span class="p">,</span> <span class="n">q2max</span> <span class="o">=</span> <span class="n">bin_</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">obs_err_dict</span><span class="p">[</span><span class="n">bin_</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">divide_binwidth</span><span class="p">:</span>
            <span class="n">err</span> <span class="o">=</span> <span class="n">err</span><span class="o">/</span><span class="p">(</span><span class="n">q2max</span><span class="o">-</span><span class="n">q2min</span><span class="p">)</span>
            <span class="n">central</span> <span class="o">=</span> <span class="n">central_</span><span class="o">/</span><span class="p">(</span><span class="n">q2max</span><span class="o">-</span><span class="n">q2min</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">central</span> <span class="o">=</span> <span class="n">central_</span>
        <span class="k">if</span> <span class="s1">&#39;fc&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="s1">&#39;facecolor&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">pastel</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;linewidth&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="s1">&#39;lw&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;lw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">_i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># the label should only be set for one (i.e. the first)</span>
            <span class="c1"># of the boxes, otherwise it will appear multiply in the legend</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">q2min</span><span class="p">,</span> <span class="n">central</span><span class="o">-</span><span class="n">err</span><span class="p">),</span> <span class="n">q2max</span><span class="o">-</span><span class="n">q2min</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">err</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="flavio.plots.plotfunctions.q2_plot_th_diff">
    <p>def <span class="ident">q2_plot_th_diff</span>(</p><p>obs_name, q2min, q2max, wc=None, q2steps=100, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Plot the central theory prediction of a $q^2$-dependent observable
as a function of $q^2$.</p>
<p>Parameters:</p>
<ul>
<li><code>q2min</code>, <code>q2max</code>: minimum and maximum $q^2$ values in GeV^2</li>
<li><code>wc</code> (optional): <code>WilsonCoefficient</code> instance to define beyond-the-SM
  Wilson coefficients</li>
<li><code>q2steps</code> (optional): number of $q^2$ steps. Defaults to 100. Less is
  faster but less precise.</li>
</ul>
<p>Additional keyword arguments are passed to the matplotlib plot function,
e.g. 'c' for colour.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.plots.plotfunctions.q2_plot_th_diff', this);">Show source &equiv;</a></p>
  <div id="source-flavio.plots.plotfunctions.q2_plot_th_diff" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">q2_plot_th_diff</span><span class="p">(</span><span class="n">obs_name</span><span class="p">,</span> <span class="n">q2min</span><span class="p">,</span> <span class="n">q2max</span><span class="p">,</span> <span class="n">wc</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">q2steps</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Plot the central theory prediction of a $q^2$-dependent observable</span>
<span class="sd">    as a function of $q^2$.</span>

<span class="sd">    Parameters:</span>

<span class="sd">    - `q2min`, `q2max`: minimum and maximum $q^2$ values in GeV^2</span>
<span class="sd">    - `wc` (optional): `WilsonCoefficient` instance to define beyond-the-SM</span>
<span class="sd">      Wilson coefficients</span>
<span class="sd">    - `q2steps` (optional): number of $q^2$ steps. Defaults to 100. Less is</span>
<span class="sd">      faster but less precise.</span>

<span class="sd">    Additional keyword arguments are passed to the matplotlib plot function,</span>
<span class="sd">    e.g. &#39;c&#39; for colour.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">obs</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">Observable</span><span class="o">.</span><span class="n">get_instance</span><span class="p">(</span><span class="n">obs_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">obs</span><span class="o">.</span><span class="n">arguments</span> <span class="o">!=</span> <span class="p">[</span><span class="s1">&#39;q2&#39;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Only observables that depend on $q^2$ (and nothing else) are allowed&quot;</span><span class="p">)</span>
    <span class="n">q2_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">q2min</span><span class="p">,</span> <span class="n">q2max</span><span class="p">,</span> <span class="p">(</span><span class="n">q2max</span><span class="o">-</span><span class="n">q2min</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">q2steps</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">wc</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">wc</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">WilsonCoefficients</span><span class="p">()</span> <span class="c1"># SM Wilson coefficients</span>
        <span class="n">obs_arr</span> <span class="o">=</span> <span class="p">[</span><span class="n">flavio</span><span class="o">.</span><span class="n">sm_prediction</span><span class="p">(</span><span class="n">obs_name</span><span class="p">,</span> <span class="n">q2</span><span class="p">)</span> <span class="k">for</span> <span class="n">q2</span> <span class="ow">in</span> <span class="n">q2_arr</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">obs_arr</span> <span class="o">=</span> <span class="p">[</span><span class="n">flavio</span><span class="o">.</span><span class="n">np_prediction</span><span class="p">(</span><span class="n">obs_name</span><span class="p">,</span> <span class="n">wc</span><span class="p">,</span> <span class="n">q2</span><span class="p">)</span> <span class="k">for</span> <span class="n">q2</span> <span class="ow">in</span> <span class="n">q2_arr</span><span class="p">]</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="k">if</span> <span class="s1">&#39;c&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="s1">&#39;color&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">q2_arr</span><span class="p">,</span> <span class="n">obs_arr</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="flavio.plots.plotfunctions.smooth_histogram">
    <p>def <span class="ident">smooth_histogram</span>(</p><p>data, bandwidth=None, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>A smooth histogram based on a Gaussian kernel density estimate.</p>
<p>Parameters:</p>
<ul>
<li><code>data</code>: input array</li>
<li><code>bandwidth</code>: (optional) smoothing bandwidth for the Gaussian kernel</li>
</ul>
<p>The remaining parameters will be passed to <code>pdf_plot</code>.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-flavio.plots.plotfunctions.smooth_histogram', this);">Show source &equiv;</a></p>
  <div id="source-flavio.plots.plotfunctions.smooth_histogram" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">smooth_histogram</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bandwidth</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A smooth histogram based on a Gaussian kernel density estimate.</span>

<span class="sd">    Parameters:</span>

<span class="sd">    - `data`: input array</span>
<span class="sd">    - `bandwidth`: (optional) smoothing bandwidth for the Gaussian kernel</span>

<span class="sd">    The remaining parameters will be passed to `pdf_plot`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kde</span> <span class="o">=</span> <span class="n">flavio</span><span class="o">.</span><span class="n">statistics</span><span class="o">.</span><span class="n">probability</span><span class="o">.</span><span class="n">GaussianKDE</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bandwidth</span><span class="o">=</span><span class="n">bandwidth</span><span class="p">)</span>
    <span class="n">pdf_plot</span><span class="p">(</span><span class="n">kde</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  


  </section>

    </article>
  <div class="clear"> </div>
  <footer id="footer">
    <p>
      Documentation generated by
      <a href="https://github.com/BurntSushi/pdoc">pdoc 0.3.2</a>
    </p>

    <p>pdoc is in the public domain with the
      <a href="http://unlicense.org">UNLICENSE</a></p>

    <p>Design by <a href="http://nadh.in">Kailash Nadh</a></p>
  </footer>
</div>

    <script>
      renderMathInElement(document.body, options={delimiters:[
  {left: "$$", right: "$$", display: true},
  {left: "\\[", right: "\\]", display: true},
  {left: "\\(", right: "\\)", display: false},
  {left: "$", right: "$", display: false}
]});
    </script>
    <script type="text/javascript">
    $("script[type='math/tex; mode=display']").replaceWith(
      function(){
        var tex = $(this).text();
        return "<span class=\"katex-display\">" +
               katex.renderToString("\\displaystyle "+tex) +
               "</span>";
    });
    </script>

</body>
</html>
